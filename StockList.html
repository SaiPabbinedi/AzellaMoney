<!--<!DOCTYPE html>-->
<!--<html lang="en">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Trending Stocks - NSE (Alpha Vantage)</title>-->
<!--    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&display=swap" rel="stylesheet">-->
<!--    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>-->
<!--    <style>-->
<!--        /* Updated styling to match the debt management UI */-->
<!--        body {-->
<!--            font-family: 'Roboto', sans-serif;-->
<!--            background: #f0f2f5;-->
<!--            margin: 0;-->
<!--            padding: 0;-->
<!--            color: #333;-->
<!--        }-->
<!--        header {-->
<!--            background: #2c3e50;-->
<!--            color: #fff;-->
<!--            padding: 20px;-->
<!--            text-align: left;-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--        }-->
<!--        header h1 {-->
<!--            margin: 0;-->
<!--            font-size: 24px;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .toggle-btn {-->
<!--            background: #3498db;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            padding: 8px 16px;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--        }-->
<!--        .container {-->
<!--            max-width: 1200px;-->
<!--            margin: 0 auto;-->
<!--            padding: 20px;-->
<!--        }-->
<!--        .section {-->
<!--            background: #fff;-->
<!--            padding: 20px;-->
<!--            margin: 10px 0 20px 0;-->
<!--            border-radius: 8px;-->
<!--            box-shadow: 0 1px 3px rgba(0,0,0,0.1);-->
<!--        }-->
<!--        .section h2 {-->
<!--            margin-top: 0;-->
<!--            font-weight: 500;-->
<!--            color: #2c3e50;-->
<!--            font-size: 20px;-->
<!--            padding-bottom: 10px;-->
<!--            border-bottom: 1px solid #eee;-->
<!--        }-->
<!--        .stock-item {-->
<!--            padding: 15px;-->
<!--            border-bottom: 1px solid #eee;-->
<!--            cursor: pointer;-->
<!--            display: flex;-->
<!--            justify-content: space-between;-->
<!--            align-items: center;-->
<!--        }-->
<!--        .stock-item:hover {-->
<!--            background: #f7f9fc;-->
<!--        }-->
<!--        .stock-info {-->
<!--            display: flex;-->
<!--            flex: 1;-->
<!--        }-->
<!--        .stock-info span {-->
<!--            flex: 1;-->
<!--            padding: 0 5px;-->
<!--        }-->
<!--        .delete-btn {-->
<!--            background: #e74c3c;-->
<!--            color: #fff;-->
<!--            border: none;-->
<!--            padding: 6px 12px;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--            margin-left: 10px;-->
<!--        }-->
<!--        /* Form styling updated */-->
<!--        form {-->
<!--            display: flex;-->
<!--            margin-bottom: 20px;-->
<!--            flex-direction: column;-->
<!--        }-->
<!--        input[type="text"] {-->
<!--            padding: 12px;-->
<!--            border: 1px solid #ddd;-->
<!--            border-radius: 4px;-->
<!--            margin-bottom: 10px;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        button[type="submit"] {-->
<!--            padding: 12px 20px;-->
<!--            border: none;-->
<!--            background: #2ecc71;-->
<!--            color: #fff;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--            font-size: 16px;-->
<!--            margin-bottom: 10px;-->
<!--        }-->
<!--        /* Action buttons */-->
<!--        .action-btn {-->
<!--            display: block;-->
<!--            width: 100%;-->
<!--            padding: 12px 20px;-->
<!--            margin: 10px 0;-->
<!--            background: #3498db;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--            text-align: center;-->
<!--            font-size: 16px;-->
<!--        }-->
<!--        .primary-btn {-->
<!--            background: #2ecc71;-->
<!--        }-->
<!--        .secondary-btn {-->
<!--            background: #3498db;-->
<!--        }-->
<!--        .navbar {-->
<!--            display: flex;-->
<!--            background: #fff;-->
<!--            border-radius: 8px;-->
<!--            overflow: hidden;-->
<!--            margin-top: 20px;-->
<!--        }-->
<!--        .nav-item {-->
<!--            flex: 1;-->
<!--            text-align: center;-->
<!--            padding: 12px;-->
<!--            cursor: pointer;-->
<!--            background: #f0f2f5;-->
<!--        }-->
<!--        .nav-item.active {-->
<!--            background: #3498db;-->
<!--            color: white;-->
<!--        }-->
<!--        /* Overlay styling */-->
<!--        .overlay {-->
<!--            position: fixed;-->
<!--            top: 0;-->
<!--            left: 0;-->
<!--            width: 100%;-->
<!--            height: 100%;-->
<!--            background: rgba(0,0,0,0.7);-->
<!--            display: flex;-->
<!--            justify-content: center;-->
<!--            align-items: center;-->
<!--            visibility: hidden;-->
<!--            opacity: 0;-->
<!--            transition: opacity 0.3s, visibility 0.3s;-->
<!--            z-index: 1000;-->
<!--        }-->
<!--        .overlay.active {-->
<!--            visibility: visible;-->
<!--            opacity: 1;-->
<!--        }-->
<!--        .overlay-content {-->
<!--            background: #fff;-->
<!--            padding: 20px;-->
<!--            border-radius: 8px;-->
<!--            width: 90%;-->
<!--            max-width: 800px;-->
<!--            position: relative;-->
<!--            max-height: 90vh;-->
<!--            overflow-y: auto;-->
<!--        }-->
<!--        .close-btn {-->
<!--            position: absolute;-->
<!--            top: 10px;-->
<!--            right: 10px;-->
<!--            background: #95a5a6;-->
<!--            color: #fff;-->
<!--            border: none;-->
<!--            padding: 6px 12px;-->
<!--            border-radius: 4px;-->
<!--            cursor: pointer;-->
<!--        }-->
<!--        canvas {-->
<!--            max-width: 100%;-->
<!--            height: auto;-->
<!--            margin-top: 20px;-->
<!--        }-->
<!--        .positive {-->
<!--            color: #2ecc71;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .negative {-->
<!--            color: #e74c3c;-->
<!--            font-weight: 500;-->
<!--        }-->
<!--        .message {-->
<!--            text-align: center;-->
<!--            color: #7f8c8d;-->
<!--            padding: 20px;-->
<!--        }-->
<!--        /*.api-notice {*/-->
<!--        /*    background-color: #fef9e7;*/-->
<!--        /*    color: #8a6d3b;*/-->
<!--        /*    border: 1px solid #faebcc;*/-->
<!--        /*    padding: 15px;*/-->
<!--        /*    margin: 15px 0;*/-->
<!--        /*    border-radius: 5px;*/-->
<!--        /*    text-align: center;*/-->
<!--        /*}*/-->
<!--        /*.api-notice a {*/-->
<!--        /*    color: #3498db;*/-->
<!--        /*    text-decoration: underline;*/-->
<!--        /*}*/-->
<!--        /* Action buttons container */-->
<!--        .action-buttons {-->
<!--            display: flex;-->
<!--            margin-top: 20px;-->
<!--            gap: 10px;-->
<!--        }-->
<!--        .action-buttons button {-->
<!--            flex: 1;-->
<!--        }-->
<!--        /* Float button */-->
<!--        .float-btn {-->
<!--            position: fixed;-->
<!--            bottom: 20px;-->
<!--            right: 20px;-->
<!--            background: #3498db;-->
<!--            color: white;-->
<!--            border: none;-->
<!--            border-radius: 50px;-->
<!--            padding: 12px 20px;-->
<!--            display: flex;-->
<!--            align-items: center;-->
<!--            box-shadow: 0 2px 10px rgba(0,0,0,0.2);-->
<!--            cursor: pointer;-->
<!--            z-index: 100;-->
<!--        }-->
<!--        .float-btn span {-->
<!--            margin-left: 8px;-->
<!--        }-->
<!--    </style>-->
<!--</head>-->
<!--<body>-->
<!--<header>-->
<!--    <h1>Stock Tracker</h1>-->
<!--    <button class="toggle-btn">Toggle Theme</button>-->
<!--</header>-->

<!--&lt;!&ndash;<div class="api-notice">&ndash;&gt;-->
<!--&lt;!&ndash;    <strong>Important:</strong> Please replace <code>'YOUR_API_KEY'</code> in the script with your free API key from <a href="https://www.alphavantage.co/support/#api-key" target="_blank">Alpha Vantage</a>. The free tier has limitations (e.g., 25 requests/day).&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->

<!--<div class="container">-->
<!--    <div class="section" id="trendingSection">-->
<!--        <h2>Trending Stocks</h2>-->
<!--        <div id="trendingList"><div class="message">Loading trending stocks...</div></div>-->
<!--    </div>-->
<!--    <div class="section" id="favoriteSection">-->
<!--        <h2>Favorite Stocks</h2>-->
<!--        <form id="favoriteForm">-->
<!--            <input type="text" id="favoriteInput" placeholder="Enter NSE symbol (e.g. TCS.NS)" required>-->
<!--            <button type="submit" class="primary-btn">Add Stock</button>-->
<!--        </form>-->
<!--        <div id="favoriteList"><div class="message">No favorite stocks added yet.</div></div>-->
<!--        <button class="action-btn secondary-btn" id="showAnalysisBtn">Show Analytics</button>-->
<!--    </div>-->

<!--    <div class="navbar">-->
<!--        <div class="nav-item active">Stocks</div>-->
<!--        <div class="nav-item">Analytics</div>-->
<!--        <div class="nav-item">History</div>-->
<!--    </div>-->
<!--</div>-->

<!--<button class="float-btn">-->
<!--    + Add Stock-->
<!--</button>-->

<!--<div class="overlay" id="overlay">-->
<!--    <div class="overlay-content">-->
<!--        <button class="close-btn" id="closeOverlay">Close</button>-->
<!--        <div id="stockDetails"><div class="message">Loading details...</div></div>-->
<!--        <canvas id="stockChart"></canvas>-->
<!--        <div class="action-buttons">-->
<!--            <button class="action-btn primary-btn" id="analyzeBtn">Analyze Strategy</button>-->
<!--        </div>-->
<!--    </div>-->
<!--</div>-->

<!--<script>-->
<!--    // -&#45;&#45; Configuration -&#45;&#45;-->
<!--    const apiKey = 'FUI5OGIATFMMMIHV'; // <&#45;&#45; IMPORTANT: Replace with your Alpha Vantage API key-->
<!--    // Note: Alpha Vantage free tier is limited (e.g., 25 requests/day).-->
<!--    // Symbols should generally match Yahoo Finance format (e.g., TCS.NS, RELIANCE.NS) for NSE stocks.-->
<!--    let trendingSymbols = ["TCS.NS", "RELIANCE.NS", "INFY.NS", "HDFCBANK.NS", "ICICIBANK.NS"];-->
<!--    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];-->
<!--    let chartInstance = null; // To keep track of the chart-->

<!--    // -&#45;&#45; DOM Elements -&#45;&#45;-->
<!--    const trendingListContainer = document.getElementById("trendingList");-->
<!--    const favoriteListContainer = document.getElementById("favoriteList");-->
<!--    const favoriteForm = document.getElementById("favoriteForm");-->
<!--    const favoriteInput = document.getElementById("favoriteInput");-->
<!--    const overlay = document.getElementById("overlay");-->
<!--    const closeOverlayBtn = document.getElementById("closeOverlay");-->
<!--    const stockDetailsContainer = document.getElementById("stockDetails");-->
<!--    const stockChartCanvas = document.getElementById("stockChart");-->
<!--    const toggleThemeBtn = document.querySelector(".toggle-btn");-->
<!--    const showAnalysisBtn = document.getElementById("showAnalysisBtn");-->
<!--    const analyzeBtn = document.getElementById("analyzeBtn");-->
<!--    const floatBtn = document.querySelector(".float-btn");-->
<!--    const navItems = document.querySelectorAll(".nav-item");-->

<!--    // -&#45;&#45; API Functions -&#45;&#45;-->

<!--    /**-->
<!--     * Fetches current quote data for multiple stock symbols from Alpha Vantage.-->
<!--     * Note: Makes one API call per symbol due to free tier limitations.-->
<!--     * @param {string[]} symbols - Array of stock symbols.-->
<!--     * @param {function} callback - Function to call with the fetched data or null on error.-->
<!--     */-->
<!--    async function fetchStockData(symbols, callback) {-->
<!--        if (apiKey === 'YOUR_API_KEY') {-->
<!--            console.error("API Key not set. Please replace 'YOUR_API_KEY'.");-->
<!--            callback(null, "API Key not configured."); // Pass error message-->
<!--            return;-->
<!--        }-->
<!--        if (!symbols || symbols.length === 0) {-->
<!--            callback([]); // Return empty array if no symbols-->
<!--            return;-->
<!--        }-->

<!--        const promises = symbols.map(symbol => {-->
<!--            const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${apiKey}`;-->
<!--            return fetch(url)-->
<!--                .then(res => {-->
<!--                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status} for ${symbol}`);-->
<!--                    return res.json();-->
<!--                })-->
<!--                .then(data => {-->
<!--                    if (data['Error Message'] || !data['Global Quote'] || Object.keys(data['Global Quote']).length === 0) {-->
<!--                        console.warn(`No data or error for symbol ${symbol}:`, data['Error Message'] || 'Empty quote');-->
<!--                        return null; // Return null for symbols with errors or no data-->
<!--                    }-->
<!--                    // Map Alpha Vantage fields to a consistent structure-->
<!--                    const quote = data['Global Quote'];-->
<!--                    return {-->
<!--                        symbol: quote['01. symbol'],-->
<!--                        longName: quote['01. symbol'], // Alpha Vantage doesn't provide long name here-->
<!--                        regularMarketPrice: parseFloat(quote['05. price']),-->
<!--                        regularMarketChange: parseFloat(quote['09. change']),-->
<!--                        regularMarketChangePercent: parseFloat(quote['10. change percent'].replace('%', '')),-->
<!--                        currency: 'INR' // Assume INR, Alpha Vantage doesn't specify in GLOBAL_QUOTE-->
<!--                    };-->
<!--                })-->
<!--                .catch(error => {-->
<!--                    console.error(`Failed to fetch data for ${symbol}:`, error);-->
<!--                    return null; // Return null if fetch fails for a specific symbol-->
<!--                });-->
<!--        });-->

<!--        try {-->
<!--            const results = await Promise.all(promises);-->
<!--            // Filter out null results (errors or no data)-->
<!--            const validResults = results.filter(result => result !== null);-->
<!--            if(validResults.length === 0 && symbols.length > 0) {-->
<!--                callback(null, "Failed to fetch data for all symbols. Check API key or rate limits.");-->
<!--            } else {-->
<!--                callback(validResults);-->
<!--            }-->
<!--        } catch (error) {-->
<!--            console.error("Error fetching stock data:", error);-->
<!--            callback(null, "An error occurred while fetching data.");-->
<!--        }-->
<!--    }-->

<!--    /**-->
<!--     * Fetches historical daily data for a stock symbol from Alpha Vantage.-->
<!--     * @param {string} symbol - The stock symbol.-->
<!--     * @param {function} callback - Function to call with the historical data or null on error.-->
<!--     */-->
<!--    function fetchHistoricalData(symbol, callback) {-->
<!--        if (apiKey === 'YOUR_API_KEY') {-->
<!--            console.error("API Key not set.");-->
<!--            callback(null, "API Key not configured.");-->
<!--            return;-->
<!--        }-->
<!--        const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=compact&apikey=${apiKey}`;-->

<!--        fetch(url)-->
<!--            .then(res => {-->
<!--                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);-->
<!--                return res.json();-->
<!--            })-->
<!--            .then(data => {-->
<!--                if (data['Error Message'] || !data['Time Series (Daily)']) {-->
<!--                    throw new Error(data['Error Message'] || 'Invalid historical data format');-->
<!--                }-->
<!--                // Process historical data for the chart-->
<!--                const timeSeries = data['Time Series (Daily)'];-->
<!--                const timestamps = Object.keys(timeSeries).sort(); // Sort dates ascending-->
<!--                const prices = timestamps.map(date => parseFloat(timeSeries[date]['4. close']));-->
<!--                const labels = timestamps.map(date => {-->
<!--                    // Format date as DD/MM-->
<!--                    const [year, month, day] = date.split('-');-->
<!--                    return `${day}/${month}`;-->
<!--                });-->

<!--                callback({ labels, prices }); // Pass processed data-->
<!--            })-->
<!--            .catch(error => {-->
<!--                console.error(`Failed to fetch historical data for ${symbol}:`, error);-->
<!--                callback(null, error.message || "Failed to fetch historical data.");-->
<!--            });-->
<!--    }-->

<!--    // -&#45;&#45; Rendering Functions -&#45;&#45;-->

<!--    /**-->
<!--     * Renders a list of stocks in the specified container.-->
<!--     * @param {object[] | null} list - Array of stock data objects, or null if error.-->
<!--     * @param {HTMLElement} container - The container element to render into.-->
<!--     * @param {boolean} isFavorite - Flag indicating if this is the favorites list.-->
<!--     * @param {string | null} errorMessage - Optional error message to display.-->
<!--     */-->
<!--    function renderStocks(list, container, isFavorite = false, errorMessage = null) {-->
<!--        container.innerHTML = ""; // Clear previous content-->

<!--        if (errorMessage) {-->
<!--            container.innerHTML = `<div class="message">${errorMessage}</div>`;-->
<!--            return;-->
<!--        }-->

<!--        if (!list || list.length === 0) {-->
<!--            const message = isFavorite ? "No favorite stocks added." : "No trending stocks available.";-->
<!--            container.innerHTML = `<div class="message">${message}</div>`;-->
<!--            return;-->
<!--        }-->

<!--        list.forEach(stock => {-->
<!--            if (!stock || !stock.symbol) return; // Skip if stock data is invalid-->

<!--            const div = document.createElement("div");-->
<!--            div.className = "stock-item";-->
<!--            div.setAttribute('data-symbol', stock.symbol); // Add data attribute for easier selection-->

<!--            const changePercent = stock.regularMarketChangePercent ? stock.regularMarketChangePercent.toFixed(2) + "%" : "N/A";-->
<!--            const changeClass = stock.regularMarketChangePercent > 0 ? "positive" : stock.regularMarketChangePercent < 0 ? "negative" : "";-->
<!--            const price = stock.regularMarketPrice ? stock.regularMarketPrice.toFixed(2) : "N/A";-->
<!--            // Currency might not always be available or correct from free APIs-->
<!--            const currency = stock.currency ? stock.currency : "";-->

<!--            const stockInfo = document.createElement("div");-->
<!--            stockInfo.className = "stock-info";-->
<!--            stockInfo.innerHTML = `-->
<!--                    <span>${stock.symbol}</span>-->
<!--                    <span>${price} ${currency}</span>-->
<!--                    <span class="${changeClass}">${changePercent}</span>-->
<!--                `;-->

<!--            div.appendChild(stockInfo);-->

<!--            // Click event to show details overlay-->
<!--            div.addEventListener("click", () => showOverlay(stock.symbol));-->

<!--            // Add delete button for favorite stocks-->
<!--            if (isFavorite) {-->
<!--                const delBtn = document.createElement("button");-->
<!--                delBtn.className = "delete-btn";-->
<!--                delBtn.innerText = "Delete";-->
<!--                delBtn.addEventListener("click", (e) => {-->
<!--                    e.stopPropagation(); // Prevent overlay from opening when deleting-->
<!--                    removeFavorite(stock.symbol);-->
<!--                });-->
<!--                div.appendChild(delBtn);-->
<!--            }-->

<!--            container.appendChild(div);-->
<!--        });-->
<!--    }-->

<!--    /**-->
<!--     * Displays the overlay with stock details and historical chart.-->
<!--     * @param {string} symbol - The stock symbol to display details for.-->
<!--     */-->
<!--    function showOverlay(symbol) {-->
<!--        stockDetailsContainer.innerHTML = `<div class="message">Loading details for ${symbol}...</div>`;-->
<!--        // Clear previous chart before fetching new data-->
<!--        if (chartInstance) {-->
<!--            chartInstance.destroy();-->
<!--            chartInstance = null;-->
<!--        }-->
<!--        overlay.classList.add("active"); // Show overlay immediately-->

<!--        // Fetch current quote data again for the selected stock-->
<!--        fetchStockData([symbol], (data, error) => {-->
<!--            if (error || !data || data.length === 0) {-->
<!--                stockDetailsContainer.innerHTML = `<div class="message">Failed to load details for ${symbol}. ${error || ''}</div>`;-->
<!--                return;-->
<!--            }-->

<!--            const info = data[0];-->
<!--            const changePercent = info.regularMarketChangePercent ? info.regularMarketChangePercent.toFixed(2) + "%" : "N/A";-->
<!--            const changeClass = info.regularMarketChangePercent > 0 ? "positive" : info.regularMarketChangePercent < 0 ? "negative" : "";-->
<!--            const price = info.regularMarketPrice ? info.regularMarketPrice.toFixed(2) : "N/A";-->
<!--            const change = info.regularMarketChange ? info.regularMarketChange.toFixed(2) : "N/A";-->
<!--            const currency = info.currency ? info.currency : "";-->
<!--            // Use symbol as name if longName isn't available-->
<!--            const name = info.longName || info.symbol;-->

<!--            const detailsHTML = `-->
<!--                    <h2>${name} (${info.symbol})</h2>-->
<!--                    <p><strong>Price:</strong> ${price} ${currency}</p>-->
<!--                    <p><strong>Change:</strong> ${change} (<span class="${changeClass}">${changePercent}</span>)</p>-->
<!--                    <hr>-->
<!--                    <p><em>Loading chart data...</em></p>-->
<!--                `;-->
<!--            stockDetailsContainer.innerHTML = detailsHTML;-->

<!--            // Fetch and render historical data chart-->
<!--            fetchHistoricalData(symbol, (histData, histError) => {-->
<!--                // Update details section based on chart loading status-->
<!--                const chartStatusMsg = document.querySelector('#stockDetails p em');-->

<!--                if (histError || !histData || !histData.labels || !histData.prices) {-->
<!--                    if (chartStatusMsg) chartStatusMsg.textContent = `Chart data unavailable. ${histError || ''}`;-->
<!--                    console.error("Failed to get historical data:", histError);-->
<!--                    return;-->
<!--                }-->

<!--                if (chartStatusMsg) chartStatusMsg.style.display = 'none'; // Hide loading message-->

<!--                // Destroy previous chart if exists-->
<!--                if (chartInstance) {-->
<!--                    chartInstance.destroy();-->
<!--                }-->

<!--                // Create new chart-->
<!--                chartInstance = new Chart(stockChartCanvas, {-->
<!--                    type: "line",-->
<!--                    data: {-->
<!--                        labels: histData.labels,-->
<!--                        datasets: [{-->
<!--                            label: `${symbol} Closing Price`,-->
<!--                            data: histData.prices,-->
<!--                            borderColor: "#3498db",-->
<!--                            backgroundColor: "rgba(52, 152, 219, 0.1)",-->
<!--                            fill: true,-->
<!--                            tension: 0.1-->
<!--                        }]-->
<!--                    },-->
<!--                    options: {-->
<!--                        responsive: true,-->
<!--                        maintainAspectRatio: true,-->
<!--                        plugins: {-->
<!--                            title: {-->
<!--                                display: true,-->
<!--                                text: `Past ~30 Days Performance`-->
<!--                            }-->
<!--                        },-->
<!--                        scales: {-->
<!--                            y: {-->
<!--                                beginAtZero: false-->
<!--                            }-->
<!--                        }-->
<!--                    }-->
<!--                });-->
<!--            });-->
<!--        });-->
<!--    }-->

<!--    // -&#45;&#45; Favorite Management -&#45;&#45;-->

<!--    /**-->
<!--     * Adds a stock symbol to the favorites list and updates storage/UI.-->
<!--     * @param {string} symbol - The stock symbol to add.-->
<!--     */-->
<!--    function addFavorite(symbol) {-->
<!--        const upperSymbol = symbol.trim().toUpperCase();-->
<!--        if (upperSymbol && !favorites.includes(upperSymbol)) {-->
<!--            favorites.push(upperSymbol);-->
<!--            localStorage.setItem("favorites", JSON.stringify(favorites));-->
<!--            loadFavorites(); // Reload the favorites list-->
<!--        }-->
<!--        favoriteInput.value = ""; // Clear input field-->
<!--    }-->

<!--    /**-->
<!--     * Removes a stock symbol from the favorites list and updates storage/UI.-->
<!--     * @param {string} symbol - The stock symbol to remove.-->
<!--     */-->
<!--    function removeFavorite(symbol) {-->
<!--        favorites = favorites.filter(fav => fav !== symbol);-->
<!--        localStorage.setItem("favorites", JSON.stringify(favorites));-->
<!--        loadFavorites(); // Reload the favorites list-->
<!--    }-->

<!--    // -&#45;&#45; Initial Load Functions -&#45;&#45;-->

<!--    /** Loads and renders trending stocks */-->
<!--    function loadTrending() {-->
<!--        trendingListContainer.innerHTML = `<div class="message">Loading trending stocks...</div>`;-->
<!--        fetchStockData(trendingSymbols, (data, error) => {-->
<!--            renderStocks(data, trendingListContainer, false, error);-->
<!--        });-->
<!--    }-->

<!--    /** Loads and renders favorite stocks */-->
<!--    function loadFavorites() {-->
<!--        if (favorites.length === 0) {-->
<!--            favoriteListContainer.innerHTML = `<div class="message">No favorite stocks added yet.</div>`;-->
<!--            return; // Don't fetch if list is empty-->
<!--        }-->
<!--        favoriteListContainer.innerHTML = `<div class="message">Loading favorite stocks...</div>`;-->
<!--        fetchStockData(favorites, (data, error) => {-->
<!--            renderStocks(data, favoriteListContainer, true, error);-->
<!--        });-->
<!--    }-->

<!--    // -&#45;&#45; Event Listeners -&#45;&#45;-->

<!--    // Add favorite stock form submission-->
<!--    favoriteForm.addEventListener("submit", (e) => {-->
<!--        e.preventDefault();-->
<!--        addFavorite(favoriteInput.value);-->
<!--    });-->

<!--    // Close overlay button-->
<!--    closeOverlayBtn.addEventListener("click", () => {-->
<!--        overlay.classList.remove("active");-->
<!--        // Destroy chart when closing overlay to free resources-->
<!--        if (chartInstance) {-->
<!--            chartInstance.destroy();-->
<!--            chartInstance = null;-->
<!--        }-->
<!--    });-->

<!--    // Close overlay if clicking outside the content area-->
<!--    overlay.addEventListener('click', (e) => {-->
<!--        if (e.target === overlay) { // Check if the click is on the overlay background itself-->
<!--            closeOverlayBtn.click(); // Simulate a click on the close button-->
<!--        }-->
<!--    });-->

<!--    // Toggle theme button (for demonstration)-->
<!--    toggleThemeBtn.addEventListener('click', () => {-->
<!--        alert('Theme toggle functionality would be implemented here.');-->
<!--    });-->

<!--    // Show analysis button-->
<!--    showAnalysisBtn.addEventListener('click', () => {-->
<!--        alert('Stock analytics would be shown here.');-->
<!--    });-->

<!--    // Analyze button in overlay-->
<!--    analyzeBtn.addEventListener('click', () => {-->
<!--        alert('Stock strategy analysis would be shown here.');-->
<!--    });-->

<!--    // Float button for adding stocks-->
<!--    floatBtn.addEventListener('click', () => {-->
<!--        favoriteInput.focus();-->
<!--    });-->

<!--    // Navigation bar-->
<!--    navItems.forEach(item => {-->
<!--        item.addEventListener('click', function() {-->
<!--            navItems.forEach(nav => nav.classList.remove('active'));-->
<!--            this.classList.add('active');-->
<!--            alert(`Would navigate to ${this.textContent} tab`);-->
<!--        });-->
<!--    });-->

<!--    // -&#45;&#45; Initial Load -&#45;&#45;-->
<!--    loadTrending();-->
<!--    loadFavorites();-->
<!--</script>-->
<!--</body>-->
<!--</html>-->

<!--&lt;!&ndash;<!DOCTYPE html>&ndash;&gt;-->
<!--&lt;!&ndash;<html lang="en">&ndash;&gt;-->
<!--&lt;!&ndash;<head>&ndash;&gt;-->
<!--&lt;!&ndash;    <meta charset="UTF-8">&ndash;&gt;-->
<!--&lt;!&ndash;    <meta name="viewport" content="width=device-width, initial-scale=1.0">&ndash;&gt;-->
<!--&lt;!&ndash;    <title>Trending Stocks - NSE (Alpha Vantage)</title>&ndash;&gt;-->
<!--&lt;!&ndash;    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&display=swap" rel="stylesheet">&ndash;&gt;-->
<!--&lt;!&ndash;    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>&ndash;&gt;-->
<!--&lt;!&ndash;    <style>&ndash;&gt;-->
<!--&lt;!&ndash;        /* -&#45;&#45; Base Styles (Light Theme) -&#45;&#45; */&ndash;&gt;-->
<!--&lt;!&ndash;        :root {&ndash;&gt;-->
<!--&lt;!&ndash;            /* Light Theme Variables */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;bg-color: #f0f2f5;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;text-color: #333;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;header-bg: #2c3e50;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;header-text: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-bg: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-border: #eee;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-shadow: rgba(0,0,0,0.1);&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;h2-color: #2c3e50;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-border: #ddd;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-bg: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-text: #333;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-primary-bg: #2ecc71;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-secondary-bg: #3498db;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-danger-bg: #e74c3c;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-text: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-bg: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-item-bg: #f0f2f5;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-item-text: #333;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-active-bg: #3498db;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-active-text: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;overlay-content-bg: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;close-btn-bg: #95a5a6;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;hover-bg: #f7f9fc;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;positive-color: #2ecc71;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;negative-color: #e74c3c;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;message-color: #7f8c8d;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;chart-border: #3498db;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;chart-bg: rgba(52, 152, 219, 0.1);&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;float-btn-bg: #3498db;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        body {&ndash;&gt;-->
<!--&lt;!&ndash;            font-family: 'Roboto', sans-serif;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;bg-color);&ndash;&gt;-->
<!--&lt;!&ndash;            margin: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;text-color);&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s, color 0.3s; /* Smooth transition */&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        header {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;header-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;header-text);&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            text-align: left;&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            justify-content: space-between;&ndash;&gt;-->
<!--&lt;!&ndash;            align-items: center;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        header h1 {&ndash;&gt;-->
<!--&lt;!&ndash;            margin: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            font-size: 24px;&ndash;&gt;-->
<!--&lt;!&ndash;            font-weight: 500;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .toggle-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;button-secondary-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 8px 16px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .container {&ndash;&gt;-->
<!--&lt;!&ndash;            max-width: 1200px;&ndash;&gt;-->
<!--&lt;!&ndash;            margin: 0 auto;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .section {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;section-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            margin: 10px 0 20px 0;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 8px;&ndash;&gt;-->
<!--&lt;!&ndash;            box-shadow: 0 1px 3px var(&#45;&#45;section-shadow);&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s, box-shadow 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .section h2 {&ndash;&gt;-->
<!--&lt;!&ndash;            margin-top: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            font-weight: 500;&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;h2-color);&ndash;&gt;-->
<!--&lt;!&ndash;            font-size: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            padding-bottom: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-bottom: 1px solid var(&#45;&#45;section-border);&ndash;&gt;-->
<!--&lt;!&ndash;            transition: color 0.3s, border-color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .stock-item {&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 15px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-bottom: 1px solid var(&#45;&#45;section-border);&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            justify-content: space-between;&ndash;&gt;-->
<!--&lt;!&ndash;            align-items: center;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.2s, border-color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .stock-item:hover {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;hover-bg);&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .stock-info {&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            flex: 1;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .stock-info span {&ndash;&gt;-->
<!--&lt;!&ndash;            flex: 1;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 0 5px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .delete-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;button-danger-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 6px 12px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-left: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        form {&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-bottom: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            flex-direction: column;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        input[type="text"] {&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 12px;&ndash;&gt;-->
<!--&lt;!&ndash;            border: 1px solid var(&#45;&#45;input-border);&ndash;&gt;-->
<!--&lt;!&ndash;            background-color: var(&#45;&#45;input-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;input-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-bottom: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;            font-size: 16px;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s, border-color 0.3s, color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        button[type="submit"] {&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 12px 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;button-primary-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            font-size: 16px;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-bottom: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .action-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            display: block;&ndash;&gt;-->
<!--&lt;!&ndash;            width: 100%;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 12px 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            margin: 10px 0;&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            text-align: center;&ndash;&gt;-->
<!--&lt;!&ndash;            font-size: 16px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .primary-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;button-primary-bg);&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .secondary-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;button-secondary-bg);&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .navbar {&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;nav-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 8px;&ndash;&gt;-->
<!--&lt;!&ndash;            overflow: hidden;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-top: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .nav-item {&ndash;&gt;-->
<!--&lt;!&ndash;            flex: 1;&ndash;&gt;-->
<!--&lt;!&ndash;            text-align: center;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 12px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;nav-item-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;nav-item-text);&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s, color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .nav-item.active {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;nav-active-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;nav-active-text);&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .overlay {&ndash;&gt;-->
<!--&lt;!&ndash;            position: fixed;&ndash;&gt;-->
<!--&lt;!&ndash;            top: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            left: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            width: 100%;&ndash;&gt;-->
<!--&lt;!&ndash;            height: 100%;&ndash;&gt;-->
<!--&lt;!&ndash;            background: rgba(0,0,0,0.7); /* Keep overlay dim */&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            justify-content: center;&ndash;&gt;-->
<!--&lt;!&ndash;            align-items: center;&ndash;&gt;-->
<!--&lt;!&ndash;            visibility: hidden;&ndash;&gt;-->
<!--&lt;!&ndash;            opacity: 0;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: opacity 0.3s, visibility 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;            z-index: 1000;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .overlay.active {&ndash;&gt;-->
<!--&lt;!&ndash;            visibility: visible;&ndash;&gt;-->
<!--&lt;!&ndash;            opacity: 1;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .overlay-content {&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;overlay-content-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;text-color); /* Use text color var */&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 8px;&ndash;&gt;-->
<!--&lt;!&ndash;            width: 90%;&ndash;&gt;-->
<!--&lt;!&ndash;            max-width: 800px;&ndash;&gt;-->
<!--&lt;!&ndash;            position: relative;&ndash;&gt;-->
<!--&lt;!&ndash;            max-height: 90vh;&ndash;&gt;-->
<!--&lt;!&ndash;            overflow-y: auto;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: background-color 0.3s, color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        /* Ensure overlay h2 inherits correctly */&ndash;&gt;-->
<!--&lt;!&ndash;        .overlay-content h2 {&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;h2-color);&ndash;&gt;-->
<!--&lt;!&ndash;            transition: color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .close-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            position: absolute;&ndash;&gt;-->
<!--&lt;!&ndash;            top: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;            right: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;close-btn-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 6px 12px;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 4px;&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        canvas {&ndash;&gt;-->
<!--&lt;!&ndash;            max-width: 100%;&ndash;&gt;-->
<!--&lt;!&ndash;            height: auto;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-top: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            /* Add background to canvas parent or style chart options for dark mode */&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .positive {&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;positive-color);&ndash;&gt;-->
<!--&lt;!&ndash;            font-weight: 500;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .negative {&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;negative-color);&ndash;&gt;-->
<!--&lt;!&ndash;            font-weight: 500;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .message {&ndash;&gt;-->
<!--&lt;!&ndash;            text-align: center;&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;message-color);&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            transition: color 0.3s;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .action-buttons {&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            margin-top: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            gap: 10px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .action-buttons button {&ndash;&gt;-->
<!--&lt;!&ndash;            flex: 1;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .float-btn {&ndash;&gt;-->
<!--&lt;!&ndash;            position: fixed;&ndash;&gt;-->
<!--&lt;!&ndash;            bottom: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            right: 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            background: var(&#45;&#45;float-btn-bg);&ndash;&gt;-->
<!--&lt;!&ndash;            color: var(&#45;&#45;button-text);&ndash;&gt;-->
<!--&lt;!&ndash;            border: none;&ndash;&gt;-->
<!--&lt;!&ndash;            border-radius: 50px;&ndash;&gt;-->
<!--&lt;!&ndash;            padding: 12px 20px;&ndash;&gt;-->
<!--&lt;!&ndash;            display: flex;&ndash;&gt;-->
<!--&lt;!&ndash;            align-items: center;&ndash;&gt;-->
<!--&lt;!&ndash;            box-shadow: 0 2px 10px rgba(0,0,0,0.2);&ndash;&gt;-->
<!--&lt;!&ndash;            cursor: pointer;&ndash;&gt;-->
<!--&lt;!&ndash;            z-index: 100;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        .float-btn span {&ndash;&gt;-->
<!--&lt;!&ndash;            margin-left: 8px;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        /* -&#45;&#45; Dark Mode Styles -&#45;&#45; */&ndash;&gt;-->
<!--&lt;!&ndash;        body.dark-mode {&ndash;&gt;-->
<!--&lt;!&ndash;            /* Dark Theme Variables */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;bg-color: #1a1a1a; /* Darker background */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;text-color: #e0e0e0; /* Lighter text */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;header-bg: #1f2937; /* Darker header */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;header-text: #e5e7eb;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-bg: #2c2c2c; /* Dark section background */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-border: #444; /* Lighter border for contrast */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;section-shadow: rgba(255,255,255,0.05); /* Subtle shadow */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;h2-color: #e5e7eb; /* Lighter heading */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-border: #555;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-bg: #333;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;input-text: #e0e0e0;&ndash;&gt;-->
<!--&lt;!&ndash;            /* Button colors might need adjustment based on preference */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-primary-bg: #10b981; /* Slightly adjusted green */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-secondary-bg: #3b82f6; /* Slightly adjusted blue */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-danger-bg: #ef4444; /* Slightly adjusted red */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;button-text: #fff; /* Keep button text white usually */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-bg: #2c2c2c;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-item-bg: #333;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-item-text: #e0e0e0;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-active-bg: #3b82f6;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;nav-active-text: #fff;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;overlay-content-bg: #2c2c2c;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;close-btn-bg: #6b7280;&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;hover-bg: #3a3a3a; /* Darker hover */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;positive-color: #34d399; /* Lighter green */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;negative-color: #f87171; /* Lighter red */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;message-color: #9ca3af; /* Lighter grey message */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;chart-border: #3b82f6; /* Match secondary button */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;chart-bg: rgba(59, 130, 246, 0.1); /* Match secondary button alpha */&ndash;&gt;-->
<!--&lt;!&ndash;            &#45;&#45;float-btn-bg: #3b82f6;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        /* Chart.js Dark Mode specific options (applied via JS) */&ndash;&gt;-->
<!--&lt;!&ndash;        .dark-mode canvas {&ndash;&gt;-->
<!--&lt;!&ndash;            /* Optionally set a bg if needed, but usually handled by Chart options */&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    </style>&ndash;&gt;-->
<!--&lt;!&ndash;</head>&ndash;&gt;-->
<!--&lt;!&ndash;<body>&ndash;&gt;-->
<!--&lt;!&ndash;<header>&ndash;&gt;-->
<!--&lt;!&ndash;    <h1>Stock Tracker</h1>&ndash;&gt;-->
<!--&lt;!&ndash;    <button class="toggle-btn">Toggle Theme</button>&ndash;&gt;-->
<!--&lt;!&ndash;</header>&ndash;&gt;-->

<!--&lt;!&ndash;<div class="container">&ndash;&gt;-->
<!--&lt;!&ndash;    <div class="section" id="trendingSection">&ndash;&gt;-->
<!--&lt;!&ndash;        <h2>Trending Stocks</h2>&ndash;&gt;-->
<!--&lt;!&ndash;        <div id="trendingList"><div class="message">Loading trending stocks...</div></div>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->
<!--&lt;!&ndash;    <div class="section" id="favoriteSection">&ndash;&gt;-->
<!--&lt;!&ndash;        <h2>Favorite Stocks</h2>&ndash;&gt;-->
<!--&lt;!&ndash;        <form id="favoriteForm">&ndash;&gt;-->
<!--&lt;!&ndash;            <input type="text" id="favoriteInput" placeholder="Enter NSE symbol (e.g. TCS.NS)" required>&ndash;&gt;-->
<!--&lt;!&ndash;            <button type="submit" class="primary-btn">Add Stock</button>&ndash;&gt;-->
<!--&lt;!&ndash;        </form>&ndash;&gt;-->
<!--&lt;!&ndash;        <div id="favoriteList"><div class="message">No favorite stocks added yet.</div></div>&ndash;&gt;-->
<!--&lt;!&ndash;        <button class="action-btn secondary-btn" id="showAnalysisBtn">Show Analytics</button>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->

<!--&lt;!&ndash;    <div class="navbar">&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="nav-item active">Stocks</div>&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="nav-item">Analytics</div>&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="nav-item">History</div>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->

<!--&lt;!&ndash;<button class="float-btn">&ndash;&gt;-->
<!--&lt;!&ndash;    + Add Stock&ndash;&gt;-->
<!--&lt;!&ndash;</button>&ndash;&gt;-->

<!--&lt;!&ndash;<div class="overlay" id="overlay">&ndash;&gt;-->
<!--&lt;!&ndash;    <div class="overlay-content">&ndash;&gt;-->
<!--&lt;!&ndash;        <button class="close-btn" id="closeOverlay">Close</button>&ndash;&gt;-->
<!--&lt;!&ndash;        <div id="stockDetails"><div class="message">Loading details...</div></div>&ndash;&gt;-->
<!--&lt;!&ndash;        <canvas id="stockChart"></canvas>&ndash;&gt;-->
<!--&lt;!&ndash;        <div class="action-buttons">&ndash;&gt;-->
<!--&lt;!&ndash;            <button class="action-btn primary-btn" id="analyzeBtn">Analyze Strategy</button>&ndash;&gt;-->
<!--&lt;!&ndash;        </div>&ndash;&gt;-->
<!--&lt;!&ndash;    </div>&ndash;&gt;-->
<!--&lt;!&ndash;</div>&ndash;&gt;-->


<!--&lt;!&ndash;<script>&ndash;&gt;-->
<!--&lt;!&ndash;    // -&#45;&#45; Configuration -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    const apiKey = 'FUI5OGIATFMMMIHV'; // Replace with your key&ndash;&gt;-->
<!--&lt;!&ndash;    let trendingSymbols = ["TCS.NS", "RELIANCE.NS", "INFY.NS", "HDFCBANK.NS", "ICICIBANK.NS"];&ndash;&gt;-->
<!--&lt;!&ndash;    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];&ndash;&gt;-->
<!--&lt;!&ndash;    let chartInstance = null;&ndash;&gt;-->

<!--&lt;!&ndash;    // -&#45;&#45; DOM Elements -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    const body = document.body; // Get body element&ndash;&gt;-->
<!--&lt;!&ndash;    const trendingListContainer = document.getElementById("trendingList");&ndash;&gt;-->
<!--&lt;!&ndash;    const favoriteListContainer = document.getElementById("favoriteList");&ndash;&gt;-->
<!--&lt;!&ndash;    const favoriteForm = document.getElementById("favoriteForm");&ndash;&gt;-->
<!--&lt;!&ndash;    const favoriteInput = document.getElementById("favoriteInput");&ndash;&gt;-->
<!--&lt;!&ndash;    const overlay = document.getElementById("overlay");&ndash;&gt;-->
<!--&lt;!&ndash;    const closeOverlayBtn = document.getElementById("closeOverlay");&ndash;&gt;-->
<!--&lt;!&ndash;    const stockDetailsContainer = document.getElementById("stockDetails");&ndash;&gt;-->
<!--&lt;!&ndash;    const stockChartCanvas = document.getElementById("stockChart");&ndash;&gt;-->
<!--&lt;!&ndash;    const toggleThemeBtn = document.querySelector(".toggle-btn"); // Already selected&ndash;&gt;-->
<!--&lt;!&ndash;    const showAnalysisBtn = document.getElementById("showAnalysisBtn");&ndash;&gt;-->
<!--&lt;!&ndash;    const analyzeBtn = document.getElementById("analyzeBtn");&ndash;&gt;-->
<!--&lt;!&ndash;    const floatBtn = document.querySelector(".float-btn");&ndash;&gt;-->
<!--&lt;!&ndash;    const navItems = document.querySelectorAll(".nav-item");&ndash;&gt;-->

<!--&lt;!&ndash;    // -&#45;&#45; API Functions (fetchStockData, fetchHistoricalData) -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    // ... (Keep your existing API functions unchanged) ...&ndash;&gt;-->
<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Fetches current quote data for multiple stock symbols from Alpha Vantage.&ndash;&gt;-->
<!--&lt;!&ndash;     * Note: Makes one API call per symbol due to free tier limitations.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string[]} symbols - Array of stock symbols.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {function} callback - Function to call with the fetched data or null on error.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    async function fetchStockData(symbols, callback) {&ndash;&gt;-->
<!--&lt;!&ndash;        if (apiKey === 'YOUR_API_KEY' || !apiKey) { // Added check for empty/null apiKey&ndash;&gt;-->
<!--&lt;!&ndash;            console.error("API Key not set. Please replace 'YOUR_API_KEY'.");&ndash;&gt;-->
<!--&lt;!&ndash;            callback(null, "API Key not configured."); // Pass error message&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        if (!symbols || symbols.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;            callback([]); // Return empty array if no symbols&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        const promises = symbols.map(symbol => {&ndash;&gt;-->
<!--&lt;!&ndash;            // Ensure symbol is valid before fetching&ndash;&gt;-->
<!--&lt;!&ndash;            if (!symbol || typeof symbol !== 'string' || symbol.trim() === '') {&ndash;&gt;-->
<!--&lt;!&ndash;                console.warn(`Invalid symbol provided: ${symbol}`);&ndash;&gt;-->
<!--&lt;!&ndash;                return Promise.resolve(null); // Resolve immediately with null for invalid symbols&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;            const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol.trim()}&apikey=${apiKey}`;&ndash;&gt;-->
<!--&lt;!&ndash;            return fetch(url)&ndash;&gt;-->
<!--&lt;!&ndash;                .then(res => {&ndash;&gt;-->
<!--&lt;!&ndash;                    if (!res.ok) throw new Error(`HTTP error! status: ${res.status} for ${symbol}`);&ndash;&gt;-->
<!--&lt;!&ndash;                    return res.json();&ndash;&gt;-->
<!--&lt;!&ndash;                })&ndash;&gt;-->
<!--&lt;!&ndash;                .then(data => {&ndash;&gt;-->
<!--&lt;!&ndash;                    // Check for API limit note&ndash;&gt;-->
<!--&lt;!&ndash;                    if (data.Note) {&ndash;&gt;-->
<!--&lt;!&ndash;                        console.warn(`API Note for ${symbol}: ${data.Note}`);&ndash;&gt;-->
<!--&lt;!&ndash;                        // You might still get data, but it indicates a potential limit hit&ndash;&gt;-->
<!--&lt;!&ndash;                        // If the quote data is missing completely due to the limit, handle it below&ndash;&gt;-->
<!--&lt;!&ndash;                    }&ndash;&gt;-->

<!--&lt;!&ndash;                    if (data['Error Message'] || !data['Global Quote'] || Object.keys(data['Global Quote']).length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                        // Specific check if Global Quote is empty likely due to API limit or invalid symbol after note&ndash;&gt;-->
<!--&lt;!&ndash;                        if (data.Note && (!data['Global Quote'] || Object.keys(data['Global Quote']).length === 0)) {&ndash;&gt;-->
<!--&lt;!&ndash;                            console.error(`API limit likely reached for ${symbol}. No quote data returned.`);&ndash;&gt;-->
<!--&lt;!&ndash;                            // Consider showing a generic "Rate Limited" message in UI for this symbol if needed&ndash;&gt;-->
<!--&lt;!&ndash;                        } else {&ndash;&gt;-->
<!--&lt;!&ndash;                            console.warn(`No data or error for symbol ${symbol}:`, data['Error Message'] || 'Empty quote or invalid symbol');&ndash;&gt;-->
<!--&lt;!&ndash;                        }&ndash;&gt;-->
<!--&lt;!&ndash;                        return null; // Return null for symbols with errors or no data&ndash;&gt;-->
<!--&lt;!&ndash;                    }&ndash;&gt;-->

<!--&lt;!&ndash;                    const quote = data['Global Quote'];&ndash;&gt;-->
<!--&lt;!&ndash;                    const price = parseFloat(quote['05. price']);&ndash;&gt;-->
<!--&lt;!&ndash;                    const change = parseFloat(quote['09. change']);&ndash;&gt;-->
<!--&lt;!&ndash;                    const changePercent = parseFloat(quote['10. change percent']?.replace('%', '')); // Optional chaining for safety&ndash;&gt;-->

<!--&lt;!&ndash;                    // Validate parsed numbers&ndash;&gt;-->
<!--&lt;!&ndash;                    if (isNaN(price) || isNaN(change) || isNaN(changePercent)) {&ndash;&gt;-->
<!--&lt;!&ndash;                        console.warn(`Invalid numeric data received for ${symbol}:`, quote);&ndash;&gt;-->
<!--&lt;!&ndash;                        return null;&ndash;&gt;-->
<!--&lt;!&ndash;                    }&ndash;&gt;-->

<!--&lt;!&ndash;                    return {&ndash;&gt;-->
<!--&lt;!&ndash;                        symbol: quote['01. symbol'],&ndash;&gt;-->
<!--&lt;!&ndash;                        longName: quote['01. symbol'], // Alpha Vantage doesn't provide long name here&ndash;&gt;-->
<!--&lt;!&ndash;                        regularMarketPrice: price,&ndash;&gt;-->
<!--&lt;!&ndash;                        regularMarketChange: change,&ndash;&gt;-->
<!--&lt;!&ndash;                        regularMarketChangePercent: changePercent,&ndash;&gt;-->
<!--&lt;!&ndash;                        currency: 'INR' // Assume INR, Alpha Vantage doesn't specify in GLOBAL_QUOTE&ndash;&gt;-->
<!--&lt;!&ndash;                    };&ndash;&gt;-->
<!--&lt;!&ndash;                })&ndash;&gt;-->
<!--&lt;!&ndash;                .catch(error => {&ndash;&gt;-->
<!--&lt;!&ndash;                    console.error(`Failed to fetch data for ${symbol}:`, error);&ndash;&gt;-->
<!--&lt;!&ndash;                    return null; // Return null if fetch fails for a specific symbol&ndash;&gt;-->
<!--&lt;!&ndash;                });&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->

<!--&lt;!&ndash;        try {&ndash;&gt;-->
<!--&lt;!&ndash;            const results = await Promise.all(promises);&ndash;&gt;-->
<!--&lt;!&ndash;            // Filter out null results (errors, invalid symbols, or no data)&ndash;&gt;-->
<!--&lt;!&ndash;            const validResults = results.filter(result => result !== null);&ndash;&gt;-->

<!--&lt;!&ndash;            if(validResults.length === 0 && symbols.some(s => s && s.trim())) { // Only show error if there were valid symbols attempted&ndash;&gt;-->
<!--&lt;!&ndash;                const generalError = "Failed to fetch data for all symbols. Check API key, rate limits, or symbol validity.";&ndash;&gt;-->
<!--&lt;!&ndash;                console.error(generalError);&ndash;&gt;-->
<!--&lt;!&ndash;                // Check if any specific API limit notes were logged&ndash;&gt;-->
<!--&lt;!&ndash;                // You could aggregate specific errors logged earlier if needed&ndash;&gt;-->
<!--&lt;!&ndash;                callback(null, generalError);&ndash;&gt;-->
<!--&lt;!&ndash;            } else {&ndash;&gt;-->
<!--&lt;!&ndash;                callback(validResults);&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;        } catch (error) {&ndash;&gt;-->
<!--&lt;!&ndash;            // This catch might handle errors in Promise.all itself, though individual fetch errors are handled above&ndash;&gt;-->
<!--&lt;!&ndash;            console.error("Error processing stock data fetches:", error);&ndash;&gt;-->
<!--&lt;!&ndash;            callback(null, "An error occurred while processing stock data requests.");&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Fetches historical daily data for a stock symbol from Alpha Vantage.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string} symbol - The stock symbol.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {function} callback - Function to call with the historical data or null on error.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    function fetchHistoricalData(symbol, callback) {&ndash;&gt;-->
<!--&lt;!&ndash;        if (apiKey === 'YOUR_API_KEY' || !apiKey) {&ndash;&gt;-->
<!--&lt;!&ndash;            console.error("API Key not set.");&ndash;&gt;-->
<!--&lt;!&ndash;            callback(null, "API Key not configured.");&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        // Use TIME_SERIES_DAILY_ADJUSTED for potentially better data, fallback to TIME_SERIES_DAILY if needed&ndash;&gt;-->
<!--&lt;!&ndash;        const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&symbol=${symbol}&outputsize=compact&apikey=${apiKey}`;&ndash;&gt;-->
<!--&lt;!&ndash;        // const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=compact&apikey=${apiKey}`;&ndash;&gt;-->

<!--&lt;!&ndash;        fetch(url)&ndash;&gt;-->
<!--&lt;!&ndash;            .then(res => {&ndash;&gt;-->
<!--&lt;!&ndash;                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);&ndash;&gt;-->
<!--&lt;!&ndash;                return res.json();&ndash;&gt;-->
<!--&lt;!&ndash;            })&ndash;&gt;-->
<!--&lt;!&ndash;            .then(data => {&ndash;&gt;-->
<!--&lt;!&ndash;                if (data.Note) {&ndash;&gt;-->
<!--&lt;!&ndash;                    console.warn(`API Note for ${symbol} (Historical): ${data.Note}`);&ndash;&gt;-->
<!--&lt;!&ndash;                    // API limit might prevent data delivery&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;                const seriesKey = 'Time Series (Daily)'; // Key used by both functions&ndash;&gt;-->
<!--&lt;!&ndash;                if (data['Error Message'] || !data[seriesKey]) {&ndash;&gt;-->
<!--&lt;!&ndash;                    const errorMsg = data['Error Message'] || 'Invalid or missing historical data format (potentially API limit)';&ndash;&gt;-->
<!--&lt;!&ndash;                    console.error(`Historical data error for ${symbol}: ${errorMsg}`);&ndash;&gt;-->
<!--&lt;!&ndash;                    throw new Error(errorMsg);&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;                // Process historical data for the chart&ndash;&gt;-->
<!--&lt;!&ndash;                const timeSeries = data[seriesKey];&ndash;&gt;-->
<!--&lt;!&ndash;                const timestamps = Object.keys(timeSeries).sort((a, b) => new Date(a) - new Date(b)); // Sort dates ascending robustly&ndash;&gt;-->

<!--&lt;!&ndash;                // Take only the last ~30 trading days for 'compact' output&ndash;&gt;-->
<!--&lt;!&ndash;                const recentTimestamps = timestamps.slice(-30);&ndash;&gt;-->

<!--&lt;!&ndash;                const prices = recentTimestamps.map(date => {&ndash;&gt;-->
<!--&lt;!&ndash;                    // Use adjusted close if available (from TIME_SERIES_DAILY_ADJUSTED), else fallback to close&ndash;&gt;-->
<!--&lt;!&ndash;                    const closePrice = timeSeries[date]['5. adjusted close'] ?? timeSeries[date]['4. close'];&ndash;&gt;-->
<!--&lt;!&ndash;                    return parseFloat(closePrice);&ndash;&gt;-->
<!--&lt;!&ndash;                });&ndash;&gt;-->

<!--&lt;!&ndash;                // Filter out any NaN prices that might occur from bad data points&ndash;&gt;-->
<!--&lt;!&ndash;                const validPrices = prices.filter(price => !isNaN(price));&ndash;&gt;-->
<!--&lt;!&ndash;                const validLabels = recentTimestamps&ndash;&gt;-->
<!--&lt;!&ndash;                    .filter((_, index) => !isNaN(prices[index])) // Filter labels corresponding to valid prices&ndash;&gt;-->
<!--&lt;!&ndash;                    .map(date => {&ndash;&gt;-->
<!--&lt;!&ndash;                        // Format date as DD/MM&ndash;&gt;-->
<!--&lt;!&ndash;                        const [year, month, day] = date.split('-');&ndash;&gt;-->
<!--&lt;!&ndash;                        // Basic validation for date parts&ndash;&gt;-->
<!--&lt;!&ndash;                        if (day && month) return `${day}/${month}`;&ndash;&gt;-->
<!--&lt;!&ndash;                        return date; // Fallback to original date string if split fails&ndash;&gt;-->
<!--&lt;!&ndash;                    });&ndash;&gt;-->


<!--&lt;!&ndash;                if (validLabels.length === 0 || validPrices.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                    console.error(`No valid historical data points found for ${symbol} after processing.`);&ndash;&gt;-->
<!--&lt;!&ndash;                    callback(null, "No valid chart data points found.");&ndash;&gt;-->
<!--&lt;!&ndash;                    return;&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->


<!--&lt;!&ndash;                callback({ labels: validLabels, prices: validPrices }); // Pass processed data&ndash;&gt;-->
<!--&lt;!&ndash;            })&ndash;&gt;-->
<!--&lt;!&ndash;            .catch(error => {&ndash;&gt;-->
<!--&lt;!&ndash;                console.error(`Failed to fetch/process historical data for ${symbol}:`, error);&ndash;&gt;-->
<!--&lt;!&ndash;                callback(null, error.message || "Failed to fetch historical data.");&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // -&#45;&#45; Rendering Functions (renderStocks) -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    // ... (Keep your existing renderStocks function unchanged) ...&ndash;&gt;-->
<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Renders a list of stocks in the specified container.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {object[] | null} list - Array of stock data objects, or null if error.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {HTMLElement} container - The container element to render into.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {boolean} isFavorite - Flag indicating if this is the favorites list.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string | null} errorMessage - Optional error message to display.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    function renderStocks(list, container, isFavorite = false, errorMessage = null) {&ndash;&gt;-->
<!--&lt;!&ndash;        container.innerHTML = ""; // Clear previous content&ndash;&gt;-->

<!--&lt;!&ndash;        if (errorMessage) {&ndash;&gt;-->
<!--&lt;!&ndash;            container.innerHTML = `<div class="message">${errorMessage}</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        // Check specifically for the case where the API returned an empty array successfully&ndash;&gt;-->
<!--&lt;!&ndash;        // This differs from an error (null list)&ndash;&gt;-->
<!--&lt;!&ndash;        if (Array.isArray(list) && list.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;            // If it's the favorites list and the original favorites array wasn't empty, it means fetch failed for all&ndash;&gt;-->
<!--&lt;!&ndash;            if (isFavorite && favorites.length > 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                container.innerHTML = `<div class="message">Could not load data for favorite stocks. Check API limits or symbol validity.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;            // If it's trending or favorites was initially empty&ndash;&gt;-->
<!--&lt;!&ndash;            else {&ndash;&gt;-->
<!--&lt;!&ndash;                const message = isFavorite ? "No favorite stocks added yet." : "No trending stocks available or failed to load.";&ndash;&gt;-->
<!--&lt;!&ndash;                container.innerHTML = `<div class="message">${message}</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        // If list is null (meaning an error occurred during the fetch process itself)&ndash;&gt;-->
<!--&lt;!&ndash;        if (list === null) {&ndash;&gt;-->
<!--&lt;!&ndash;            const message = `Error loading ${isFavorite ? 'favorite' : 'trending'} stocks. Please try again later.`;&ndash;&gt;-->
<!--&lt;!&ndash;            container.innerHTML = `<div class="message">${message}</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->


<!--&lt;!&ndash;        list.forEach(stock => {&ndash;&gt;-->
<!--&lt;!&ndash;            // Extra validation within the loop&ndash;&gt;-->
<!--&lt;!&ndash;            if (!stock || !stock.symbol || typeof stock.regularMarketPrice === 'undefined' || typeof stock.regularMarketChangePercent === 'undefined') {&ndash;&gt;-->
<!--&lt;!&ndash;                console.warn('Skipping rendering invalid stock data:', stock);&ndash;&gt;-->
<!--&lt;!&ndash;                return; // Skip if stock data is incomplete or invalid&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->

<!--&lt;!&ndash;            const div = document.createElement("div");&ndash;&gt;-->
<!--&lt;!&ndash;            div.className = "stock-item";&ndash;&gt;-->
<!--&lt;!&ndash;            div.setAttribute('data-symbol', stock.symbol); // Add data attribute for easier selection&ndash;&gt;-->

<!--&lt;!&ndash;            const changePercent = stock.regularMarketChangePercent ? stock.regularMarketChangePercent.toFixed(2) + "%" : "N/A";&ndash;&gt;-->
<!--&lt;!&ndash;            const changeClass = stock.regularMarketChangePercent > 0 ? "positive" : stock.regularMarketChangePercent < 0 ? "negative" : "";&ndash;&gt;-->
<!--&lt;!&ndash;            const price = stock.regularMarketPrice ? stock.regularMarketPrice.toFixed(2) : "N/A";&ndash;&gt;-->
<!--&lt;!&ndash;            // Currency might not always be available or correct from free APIs&ndash;&gt;-->
<!--&lt;!&ndash;            const currency = stock.currency ? stock.currency : ""; // Usually 'INR' as set earlier&ndash;&gt;-->

<!--&lt;!&ndash;            const stockInfo = document.createElement("div");&ndash;&gt;-->
<!--&lt;!&ndash;            stockInfo.className = "stock-info";&ndash;&gt;-->
<!--&lt;!&ndash;            stockInfo.innerHTML = `&ndash;&gt;-->
<!--&lt;!&ndash;                    <span>${stock.symbol || 'N/A'}</span>&ndash;&gt;-->
<!--&lt;!&ndash;                    <span>${price} ${currency}</span>&ndash;&gt;-->
<!--&lt;!&ndash;                    <span class="${changeClass}">${changePercent}</span>&ndash;&gt;-->
<!--&lt;!&ndash;                `;&ndash;&gt;-->

<!--&lt;!&ndash;            div.appendChild(stockInfo);&ndash;&gt;-->

<!--&lt;!&ndash;            // Click event to show details overlay&ndash;&gt;-->
<!--&lt;!&ndash;            div.addEventListener("click", (e) => {&ndash;&gt;-->
<!--&lt;!&ndash;                // Prevent clicks on the delete button from triggering the overlay&ndash;&gt;-->
<!--&lt;!&ndash;                if (e.target.classList.contains('delete-btn')) {&ndash;&gt;-->
<!--&lt;!&ndash;                    return;&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;                showOverlay(stock.symbol);&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->


<!--&lt;!&ndash;            // Add delete button for favorite stocks&ndash;&gt;-->
<!--&lt;!&ndash;            if (isFavorite) {&ndash;&gt;-->
<!--&lt;!&ndash;                const delBtn = document.createElement("button");&ndash;&gt;-->
<!--&lt;!&ndash;                delBtn.className = "delete-btn";&ndash;&gt;-->
<!--&lt;!&ndash;                delBtn.innerText = "Delete";&ndash;&gt;-->
<!--&lt;!&ndash;                delBtn.addEventListener("click", (e) => {&ndash;&gt;-->
<!--&lt;!&ndash;                    e.stopPropagation(); // Prevent overlay from opening when deleting&ndash;&gt;-->
<!--&lt;!&ndash;                    removeFavorite(stock.symbol);&ndash;&gt;-->
<!--&lt;!&ndash;                });&ndash;&gt;-->
<!--&lt;!&ndash;                div.appendChild(delBtn);&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->

<!--&lt;!&ndash;            container.appendChild(div);&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // -&#45;&#45; Overlay and Chart Functions (showOverlay) -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Displays the overlay with stock details and historical chart.&ndash;&gt;-->
<!--&lt;!&ndash;     * Handles theme changes for the chart.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string} symbol - The stock symbol to display details for.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    function showOverlay(symbol) {&ndash;&gt;-->
<!--&lt;!&ndash;        stockDetailsContainer.innerHTML = `<div class="message">Loading details for ${symbol}...</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;        if (chartInstance) {&ndash;&gt;-->
<!--&lt;!&ndash;            chartInstance.destroy();&ndash;&gt;-->
<!--&lt;!&ndash;            chartInstance = null;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        overlay.classList.add("active");&ndash;&gt;-->

<!--&lt;!&ndash;        // Fetch current quote data&ndash;&gt;-->
<!--&lt;!&ndash;        fetchStockData([symbol], (data, error) => {&ndash;&gt;-->
<!--&lt;!&ndash;            if (error || !data || data.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                // Check if data is empty array vs null error&ndash;&gt;-->
<!--&lt;!&ndash;                const errorMessageText = error ? error : `Failed to load details for ${symbol}. Symbol might be invalid or API limit reached.`;&ndash;&gt;-->
<!--&lt;!&ndash;                stockDetailsContainer.innerHTML = `<div class="message">${errorMessageText}</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;                // Clear canvas if data fails&ndash;&gt;-->
<!--&lt;!&ndash;                const ctx = stockChartCanvas.getContext('2d');&ndash;&gt;-->
<!--&lt;!&ndash;                ctx.clearRect(0, 0, stockChartCanvas.width, stockChartCanvas.height);&ndash;&gt;-->
<!--&lt;!&ndash;                return;&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->

<!--&lt;!&ndash;            const info = data[0];&ndash;&gt;-->
<!--&lt;!&ndash;            // Validate essential info&ndash;&gt;-->
<!--&lt;!&ndash;            if (!info || typeof info.regularMarketPrice === 'undefined' || typeof info.regularMarketChangePercent === 'undefined') {&ndash;&gt;-->
<!--&lt;!&ndash;                stockDetailsContainer.innerHTML = `<div class="message">Incomplete data received for ${symbol}.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;                // Clear canvas&ndash;&gt;-->
<!--&lt;!&ndash;                const ctx = stockChartCanvas.getContext('2d');&ndash;&gt;-->
<!--&lt;!&ndash;                ctx.clearRect(0, 0, stockChartCanvas.width, stockChartCanvas.height);&ndash;&gt;-->
<!--&lt;!&ndash;                return;&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->

<!--&lt;!&ndash;            const changePercent = info.regularMarketChangePercent.toFixed(2) + "%";&ndash;&gt;-->
<!--&lt;!&ndash;            const changeClass = info.regularMarketChangePercent > 0 ? "positive" : info.regularMarketChangePercent < 0 ? "negative" : "";&ndash;&gt;-->
<!--&lt;!&ndash;            const price = info.regularMarketPrice.toFixed(2);&ndash;&gt;-->
<!--&lt;!&ndash;            const change = info.regularMarketChange ? info.regularMarketChange.toFixed(2) : "N/A";&ndash;&gt;-->
<!--&lt;!&ndash;            const currency = info.currency || "";&ndash;&gt;-->
<!--&lt;!&ndash;            const name = info.longName || info.symbol;&ndash;&gt;-->

<!--&lt;!&ndash;            const detailsHTML = `&ndash;&gt;-->
<!--&lt;!&ndash;                    <h2>${name} (${info.symbol})</h2>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Price:</strong> ${price} ${currency}</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><strong>Change:</strong> ${change} (<span class="${changeClass}">${changePercent}</span>)</p>&ndash;&gt;-->
<!--&lt;!&ndash;                    <hr>&ndash;&gt;-->
<!--&lt;!&ndash;                    <p><em>Loading chart data...</em></p>&ndash;&gt;-->
<!--&lt;!&ndash;                `;&ndash;&gt;-->
<!--&lt;!&ndash;            stockDetailsContainer.innerHTML = detailsHTML;&ndash;&gt;-->

<!--&lt;!&ndash;            // Fetch and render historical data chart&ndash;&gt;-->
<!--&lt;!&ndash;            fetchHistoricalData(symbol, (histData, histError) => {&ndash;&gt;-->
<!--&lt;!&ndash;                const chartStatusMsg = document.querySelector('#stockDetails p em');&ndash;&gt;-->

<!--&lt;!&ndash;                if (histError || !histData || !histData.labels || !histData.prices || histData.labels.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;                    if (chartStatusMsg) chartStatusMsg.textContent = `Chart data unavailable. ${histError || 'No data points.'}`;&ndash;&gt;-->
<!--&lt;!&ndash;                    console.error("Failed to get valid historical data:", histError, histData);&ndash;&gt;-->
<!--&lt;!&ndash;                    // Clear canvas on error&ndash;&gt;-->
<!--&lt;!&ndash;                    const ctx = stockChartCanvas.getContext('2d');&ndash;&gt;-->
<!--&lt;!&ndash;                    ctx.clearRect(0, 0, stockChartCanvas.width, stockChartCanvas.height);&ndash;&gt;-->
<!--&lt;!&ndash;                    return;&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->

<!--&lt;!&ndash;                if (chartStatusMsg) chartStatusMsg.style.display = 'none';&ndash;&gt;-->

<!--&lt;!&ndash;                // -&#45;&#45; Theme-aware Chart Configuration -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;                const isDarkMode = body.classList.contains('dark-mode');&ndash;&gt;-->
<!--&lt;!&ndash;                const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';&ndash;&gt;-->
<!--&lt;!&ndash;                const textColor = isDarkMode ? '#e0e0e0' : '#333';&ndash;&gt;-->
<!--&lt;!&ndash;                const chartBorderColor = getComputedStyle(document.documentElement).getPropertyValue(isDarkMode ? '&#45;&#45;chart-border-dark' : '&#45;&#45;chart-border').trim() || (isDarkMode ? '#3b82f6' : '#3498db');&ndash;&gt;-->
<!--&lt;!&ndash;                const chartBgColor = getComputedStyle(document.documentElement).getPropertyValue(isDarkMode ? '&#45;&#45;chart-bg-dark' : '&#45;&#45;chart-bg').trim() || (isDarkMode ? 'rgba(59, 130, 246, 0.1)' : 'rgba(52, 152, 219, 0.1)');&ndash;&gt;-->
<!--&lt;!&ndash;                // -&#45;&#45; End Theme-aware Chart Config -&#45;&#45;&ndash;&gt;-->


<!--&lt;!&ndash;                if (chartInstance) { // Should have been destroyed earlier, but double-check&ndash;&gt;-->
<!--&lt;!&ndash;                    chartInstance.destroy();&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->

<!--&lt;!&ndash;                chartInstance = new Chart(stockChartCanvas, {&ndash;&gt;-->
<!--&lt;!&ndash;                    type: "line",&ndash;&gt;-->
<!--&lt;!&ndash;                    data: {&ndash;&gt;-->
<!--&lt;!&ndash;                        labels: histData.labels,&ndash;&gt;-->
<!--&lt;!&ndash;                        datasets: [{&ndash;&gt;-->
<!--&lt;!&ndash;                            label: `${symbol} Closing Price`,&ndash;&gt;-->
<!--&lt;!&ndash;                            data: histData.prices,&ndash;&gt;-->
<!--&lt;!&ndash;                            borderColor: chartBorderColor, // Use theme variable&ndash;&gt;-->
<!--&lt;!&ndash;                            backgroundColor: chartBgColor, // Use theme variable&ndash;&gt;-->
<!--&lt;!&ndash;                            fill: true,&ndash;&gt;-->
<!--&lt;!&ndash;                            tension: 0.1,&ndash;&gt;-->
<!--&lt;!&ndash;                            pointRadius: 1, // Smaller points&ndash;&gt;-->
<!--&lt;!&ndash;                            pointHoverRadius: 5&ndash;&gt;-->
<!--&lt;!&ndash;                        }]&ndash;&gt;-->
<!--&lt;!&ndash;                    },&ndash;&gt;-->
<!--&lt;!&ndash;                    options: {&ndash;&gt;-->
<!--&lt;!&ndash;                        responsive: true,&ndash;&gt;-->
<!--&lt;!&ndash;                        maintainAspectRatio: true, // Adjust as needed, false might allow more flexible sizing&ndash;&gt;-->
<!--&lt;!&ndash;                        plugins: {&ndash;&gt;-->
<!--&lt;!&ndash;                            title: {&ndash;&gt;-->
<!--&lt;!&ndash;                                display: true,&ndash;&gt;-->
<!--&lt;!&ndash;                                text: `Past ~30 Trading Days Performance`,&ndash;&gt;-->
<!--&lt;!&ndash;                                color: textColor // Theme-aware title color&ndash;&gt;-->
<!--&lt;!&ndash;                            },&ndash;&gt;-->
<!--&lt;!&ndash;                            legend: {&ndash;&gt;-->
<!--&lt;!&ndash;                                labels: {&ndash;&gt;-->
<!--&lt;!&ndash;                                    color: textColor // Theme-aware legend color&ndash;&gt;-->
<!--&lt;!&ndash;                                }&ndash;&gt;-->
<!--&lt;!&ndash;                            }&ndash;&gt;-->
<!--&lt;!&ndash;                        },&ndash;&gt;-->
<!--&lt;!&ndash;                        scales: {&ndash;&gt;-->
<!--&lt;!&ndash;                            y: {&ndash;&gt;-->
<!--&lt;!&ndash;                                beginAtZero: false,&ndash;&gt;-->
<!--&lt;!&ndash;                                ticks: {&ndash;&gt;-->
<!--&lt;!&ndash;                                    color: textColor // Theme-aware Y-axis labels&ndash;&gt;-->
<!--&lt;!&ndash;                                },&ndash;&gt;-->
<!--&lt;!&ndash;                                grid: {&ndash;&gt;-->
<!--&lt;!&ndash;                                    color: gridColor // Theme-aware Y-axis grid lines&ndash;&gt;-->
<!--&lt;!&ndash;                                }&ndash;&gt;-->
<!--&lt;!&ndash;                            },&ndash;&gt;-->
<!--&lt;!&ndash;                            x: {&ndash;&gt;-->
<!--&lt;!&ndash;                                ticks: {&ndash;&gt;-->
<!--&lt;!&ndash;                                    color: textColor, // Theme-aware X-axis labels&ndash;&gt;-->
<!--&lt;!&ndash;                                    maxRotation: 45, // Rotate labels slightly if they overlap&ndash;&gt;-->
<!--&lt;!&ndash;                                    minRotation: 0,&ndash;&gt;-->
<!--&lt;!&ndash;                                    autoSkip: true, // Allow Chart.js to skip labels if too crowded&ndash;&gt;-->
<!--&lt;!&ndash;                                    maxTicksLimit: 10 // Limit the number of visible ticks further&ndash;&gt;-->
<!--&lt;!&ndash;                                },&ndash;&gt;-->
<!--&lt;!&ndash;                                grid: {&ndash;&gt;-->
<!--&lt;!&ndash;                                    color: gridColor // Theme-aware X-axis grid lines&ndash;&gt;-->
<!--&lt;!&ndash;                                }&ndash;&gt;-->
<!--&lt;!&ndash;                            }&ndash;&gt;-->
<!--&lt;!&ndash;                        }&ndash;&gt;-->
<!--&lt;!&ndash;                    }&ndash;&gt;-->
<!--&lt;!&ndash;                });&ndash;&gt;-->
<!--&lt;!&ndash;            });&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // -&#45;&#45; Favorite Management (addFavorite, removeFavorite) -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    // ... (Keep your existing favorite management functions unchanged) ...&ndash;&gt;-->
<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Adds a stock symbol to the favorites list and updates storage/UI.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string} symbol - The stock symbol to add.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    function addFavorite(symbol) {&ndash;&gt;-->
<!--&lt;!&ndash;        // Basic validation and sanitization&ndash;&gt;-->
<!--&lt;!&ndash;        if (!symbol || typeof symbol !== 'string') {&ndash;&gt;-->
<!--&lt;!&ndash;            alert("Please enter a valid stock symbol.");&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        // Trim whitespace and convert to uppercase (consistent format)&ndash;&gt;-->
<!--&lt;!&ndash;        // Allow '.' for NSE symbols like TCS.NS&ndash;&gt;-->
<!--&lt;!&ndash;        const upperSymbol = symbol.trim().toUpperCase().replace(/[^A-Z0-9.-]/g, ''); // Allow letters, numbers, dot, hyphen&ndash;&gt;-->

<!--&lt;!&ndash;        if (!upperSymbol) {&ndash;&gt;-->
<!--&lt;!&ndash;            alert("Invalid symbol format.");&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteInput.value = ""; // Clear potentially invalid input&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->


<!--&lt;!&ndash;        // Prevent duplicates (case-insensitive check already handled by toUpperCase)&ndash;&gt;-->
<!--&lt;!&ndash;        if (favorites.includes(upperSymbol)) {&ndash;&gt;-->
<!--&lt;!&ndash;            alert(`${upperSymbol} is already in favorites.`);&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteInput.value = ""; // Clear input&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        // Optional: Add a limit to the number of favorites?&ndash;&gt;-->
<!--&lt;!&ndash;        // const MAX_FAVORITES = 20;&ndash;&gt;-->
<!--&lt;!&ndash;        // if (favorites.length >= MAX_FAVORITES) {&ndash;&gt;-->
<!--&lt;!&ndash;        //     alert(`You can only add up to ${MAX_FAVORITES} favorites.`);&ndash;&gt;-->
<!--&lt;!&ndash;        //     return;&ndash;&gt;-->
<!--&lt;!&ndash;        // }&ndash;&gt;-->


<!--&lt;!&ndash;        favorites.push(upperSymbol);&ndash;&gt;-->
<!--&lt;!&ndash;        try {&ndash;&gt;-->
<!--&lt;!&ndash;            localStorage.setItem("favorites", JSON.stringify(favorites));&ndash;&gt;-->
<!--&lt;!&ndash;        } catch (e) {&ndash;&gt;-->
<!--&lt;!&ndash;            console.error("Failed to save favorites to localStorage:", e);&ndash;&gt;-->
<!--&lt;!&ndash;            alert("Could not save favorites. Local storage might be full or disabled.");&ndash;&gt;-->
<!--&lt;!&ndash;            // Optionally remove the added favorite if saving failed&ndash;&gt;-->
<!--&lt;!&ndash;            favorites.pop(); // Remove the last added item&ndash;&gt;-->
<!--&lt;!&ndash;            return; // Stop execution if save failed&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        loadFavorites(); // Reload the favorites list UI&ndash;&gt;-->
<!--&lt;!&ndash;        favoriteInput.value = ""; // Clear input field after successful add&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    /**&ndash;&gt;-->
<!--&lt;!&ndash;     * Removes a stock symbol from the favorites list and updates storage/UI.&ndash;&gt;-->
<!--&lt;!&ndash;     * @param {string} symbol - The stock symbol to remove.&ndash;&gt;-->
<!--&lt;!&ndash;     */&ndash;&gt;-->
<!--&lt;!&ndash;    function removeFavorite(symbol) {&ndash;&gt;-->
<!--&lt;!&ndash;        // Ensure symbol exists before filtering&ndash;&gt;-->
<!--&lt;!&ndash;        if (!favorites.includes(symbol)) {&ndash;&gt;-->
<!--&lt;!&ndash;            console.warn(`Attempted to remove non-existent favorite: ${symbol}`);&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        favorites = favorites.filter(fav => fav !== symbol);&ndash;&gt;-->
<!--&lt;!&ndash;        try {&ndash;&gt;-->
<!--&lt;!&ndash;            localStorage.setItem("favorites", JSON.stringify(favorites));&ndash;&gt;-->
<!--&lt;!&ndash;        } catch (e) {&ndash;&gt;-->
<!--&lt;!&ndash;            console.error("Failed to save updated favorites to localStorage:", e);&ndash;&gt;-->
<!--&lt;!&ndash;            alert("Could not update favorites list. Local storage might be full or disabled.");&ndash;&gt;-->
<!--&lt;!&ndash;            // Re-add the symbol to the JS array if saving fails to keep UI consistent with actual state?&ndash;&gt;-->
<!--&lt;!&ndash;            // This depends on desired behavior - usually better to reflect the failed save.&ndash;&gt;-->
<!--&lt;!&ndash;            loadFavorites(); // Still try to reload UI to show current state if possible&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        loadFavorites(); // Reload the favorites list UI to reflect removal&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // -&#45;&#45; Initial Load Functions (loadTrending, loadFavorites) -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    // ... (Keep your existing load functions unchanged) ...&ndash;&gt;-->
<!--&lt;!&ndash;    /** Loads and renders trending stocks */&ndash;&gt;-->
<!--&lt;!&ndash;    function loadTrending() {&ndash;&gt;-->
<!--&lt;!&ndash;        trendingListContainer.innerHTML = `<div class="message">Loading trending stocks...</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;        fetchStockData(trendingSymbols, (data, error) => {&ndash;&gt;-->
<!--&lt;!&ndash;            renderStocks(data, trendingListContainer, false, error);&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    /** Loads and renders favorite stocks */&ndash;&gt;-->
<!--&lt;!&ndash;    function loadFavorites() {&ndash;&gt;-->
<!--&lt;!&ndash;        // If favorites array is empty, render the message immediately and don't fetch&ndash;&gt;-->
<!--&lt;!&ndash;        if (!Array.isArray(favorites) || favorites.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteListContainer.innerHTML = `<div class="message">No favorite stocks added yet.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            return; // Don't proceed to fetch if the list is empty&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;        favoriteListContainer.innerHTML = `<div class="message">Loading favorite stocks...</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;        // Filter out any potentially invalid entries (e.g., null, empty strings) before fetching&ndash;&gt;-->
<!--&lt;!&ndash;        const validFavorites = favorites.filter(fav => fav && typeof fav === 'string' && fav.trim() !== '');&ndash;&gt;-->
<!--&lt;!&ndash;        if (validFavorites.length === 0) {&ndash;&gt;-->
<!--&lt;!&ndash;            // This case means the 'favorites' array contained only invalid entries&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteListContainer.innerHTML = `<div class="message">No valid favorite stocks found.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;            return;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        fetchStockData(validFavorites, (data, error) => {&ndash;&gt;-->
<!--&lt;!&ndash;            renderStocks(data, favoriteListContainer, true, error);&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    // -&#45;&#45; Theme Toggle Function -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    function toggleTheme() {&ndash;&gt;-->
<!--&lt;!&ndash;        body.classList.toggle('dark-mode');&ndash;&gt;-->
<!--&lt;!&ndash;        const isDarkMode = body.classList.contains('dark-mode');&ndash;&gt;-->
<!--&lt;!&ndash;        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');&ndash;&gt;-->
<!--&lt;!&ndash;        updateToggleButtonText(isDarkMode);&ndash;&gt;-->

<!--&lt;!&ndash;        // If overlay is active, re-render chart with new theme colors&ndash;&gt;-->
<!--&lt;!&ndash;        if (overlay.classList.contains('active') && chartInstance) {&ndash;&gt;-->
<!--&lt;!&ndash;            const symbol = stockDetailsContainer.querySelector('h2')?.textContent.match(/\(([^)]+)\)/)?.[1];&ndash;&gt;-->
<!--&lt;!&ndash;            if (symbol) {&ndash;&gt;-->
<!--&lt;!&ndash;                // Re-trigger chart rendering part of showOverlay, using existing data if possible&ndash;&gt;-->
<!--&lt;!&ndash;                // Or simpler: just re-call showOverlay which handles fetching/charting&ndash;&gt;-->
<!--&lt;!&ndash;                // However, re-calling showOverlay re-fetches data, which might not be ideal.&ndash;&gt;-->
<!--&lt;!&ndash;                // A better approach is to update the existing chart options.&ndash;&gt;-->

<!--&lt;!&ndash;                updateChartTheme(); // Call dedicated function to update chart style&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->

<!--&lt;!&ndash;    // Helper to update chart theme without full redraw/fetch&ndash;&gt;-->
<!--&lt;!&ndash;    function updateChartTheme() {&ndash;&gt;-->
<!--&lt;!&ndash;        if (!chartInstance) return;&ndash;&gt;-->

<!--&lt;!&ndash;        const isDarkMode = body.classList.contains('dark-mode');&ndash;&gt;-->
<!--&lt;!&ndash;        const gridColor = isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)';&ndash;&gt;-->
<!--&lt;!&ndash;        const textColor = isDarkMode ? '#e0e0e0' : '#333';&ndash;&gt;-->
<!--&lt;!&ndash;        const chartBorderColor = getComputedStyle(document.documentElement).getPropertyValue(isDarkMode ? '&#45;&#45;chart-border-dark' : '&#45;&#45;chart-border').trim() || (isDarkMode ? '#3b82f6' : '#3498db');&ndash;&gt;-->
<!--&lt;!&ndash;        const chartBgColor = getComputedStyle(document.documentElement).getPropertyValue(isDarkMode ? '&#45;&#45;chart-bg-dark' : '&#45;&#45;chart-bg').trim() || (isDarkMode ? 'rgba(59, 130, 246, 0.1)' : 'rgba(52, 152, 219, 0.1)');&ndash;&gt;-->


<!--&lt;!&ndash;        // Update colors in options&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.plugins.title.color = textColor;&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.plugins.legend.labels.color = textColor;&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.scales.y.ticks.color = textColor;&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.scales.y.grid.color = gridColor;&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.scales.x.ticks.color = textColor;&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.options.scales.x.grid.color = gridColor;&ndash;&gt;-->

<!--&lt;!&ndash;        // Update dataset colors&ndash;&gt;-->
<!--&lt;!&ndash;        chartInstance.data.datasets.forEach(dataset => {&ndash;&gt;-->
<!--&lt;!&ndash;            dataset.borderColor = chartBorderColor;&ndash;&gt;-->
<!--&lt;!&ndash;            dataset.backgroundColor = chartBgColor;&ndash;&gt;-->
<!--&lt;!&ndash;        });&ndash;&gt;-->

<!--&lt;!&ndash;        chartInstance.update(); // Apply the changes&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // Helper to set button text&ndash;&gt;-->
<!--&lt;!&ndash;    function updateToggleButtonText(isDarkMode) {&ndash;&gt;-->
<!--&lt;!&ndash;        toggleThemeBtn.textContent = isDarkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode';&ndash;&gt;-->
<!--&lt;!&ndash;    }&ndash;&gt;-->


<!--&lt;!&ndash;    // -&#45;&#45; Event Listeners -&#45;&#45;&ndash;&gt;-->

<!--&lt;!&ndash;    // Add favorite stock form submission&ndash;&gt;-->
<!--&lt;!&ndash;    favoriteForm.addEventListener("submit", (e) => {&ndash;&gt;-->
<!--&lt;!&ndash;        e.preventDefault();&ndash;&gt;-->
<!--&lt;!&ndash;        addFavorite(favoriteInput.value);&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // Close overlay button&ndash;&gt;-->
<!--&lt;!&ndash;    closeOverlayBtn.addEventListener("click", () => {&ndash;&gt;-->
<!--&lt;!&ndash;        overlay.classList.remove("active");&ndash;&gt;-->
<!--&lt;!&ndash;        if (chartInstance) {&ndash;&gt;-->
<!--&lt;!&ndash;            chartInstance.destroy();&ndash;&gt;-->
<!--&lt;!&ndash;            chartInstance = null;&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // Close overlay if clicking outside the content area&ndash;&gt;-->
<!--&lt;!&ndash;    overlay.addEventListener('click', (e) => {&ndash;&gt;-->
<!--&lt;!&ndash;        if (e.target === overlay) {&ndash;&gt;-->
<!--&lt;!&ndash;            closeOverlayBtn.click();&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // Toggle theme button&ndash;&gt;-->
<!--&lt;!&ndash;    toggleThemeBtn.addEventListener('click', toggleTheme); // Use the new function&ndash;&gt;-->

<!--&lt;!&ndash;    // Show analysis button&ndash;&gt;-->
<!--&lt;!&ndash;    showAnalysisBtn.addEventListener('click', () => {&ndash;&gt;-->
<!--&lt;!&ndash;        // Placeholder: Implement actual analytics view or function&ndash;&gt;-->
<!--&lt;!&ndash;        alert('Analytics feature coming soon!');&ndash;&gt;-->
<!--&lt;!&ndash;        // Example: You could switch to the 'Analytics' nav tab&ndash;&gt;-->
<!--&lt;!&ndash;        // const analyticsTab = document.querySelector('.nav-item:nth-child(2)');&ndash;&gt;-->
<!--&lt;!&ndash;        // if (analyticsTab) {&ndash;&gt;-->
<!--&lt;!&ndash;        //     navItems.forEach(nav => nav.classList.remove('active'));&ndash;&gt;-->
<!--&lt;!&ndash;        //     analyticsTab.classList.add('active');&ndash;&gt;-->
<!--&lt;!&ndash;        //     // Potentially hide/show different container sections based on the active tab&ndash;&gt;-->
<!--&lt;!&ndash;        // }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // Analyze button in overlay&ndash;&gt;-->
<!--&lt;!&ndash;    analyzeBtn.addEventListener('click', () => {&ndash;&gt;-->
<!--&lt;!&ndash;        // Placeholder: Implement analysis for the stock shown in the overlay&ndash;&gt;-->
<!--&lt;!&ndash;        const symbol = stockDetailsContainer.querySelector('h2')?.textContent.match(/\(([^)]+)\)/)?.[1];&ndash;&gt;-->
<!--&lt;!&ndash;        if (symbol) {&ndash;&gt;-->
<!--&lt;!&ndash;            alert(`Strategy analysis for ${symbol} coming soon!`);&ndash;&gt;-->
<!--&lt;!&ndash;        } else {&ndash;&gt;-->
<!--&lt;!&ndash;            alert('Strategy analysis coming soon!');&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->


<!--&lt;!&ndash;    // Float button for adding stocks (focus input)&ndash;&gt;-->
<!--&lt;!&ndash;    floatBtn.addEventListener('click', () => {&ndash;&gt;-->
<!--&lt;!&ndash;        // Scroll to the favorite section and focus the input for better UX&ndash;&gt;-->
<!--&lt;!&ndash;        const favoriteSection = document.getElementById('favoriteSection');&ndash;&gt;-->
<!--&lt;!&ndash;        if (favoriteSection) {&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteSection.scrollIntoView({ behavior: 'smooth', block: 'start' });&ndash;&gt;-->
<!--&lt;!&ndash;            // Add a small delay for the scroll to finish before focusing&ndash;&gt;-->
<!--&lt;!&ndash;            setTimeout(() => {&ndash;&gt;-->
<!--&lt;!&ndash;                favoriteInput.focus();&ndash;&gt;-->
<!--&lt;!&ndash;            }, 300); // Adjust delay if needed&ndash;&gt;-->
<!--&lt;!&ndash;        } else {&ndash;&gt;-->
<!--&lt;!&ndash;            favoriteInput.focus(); // Fallback if section not found&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // Navigation bar (basic alert functionality)&ndash;&gt;-->
<!--&lt;!&ndash;    navItems.forEach((item, index) => {&ndash;&gt;-->
<!--&lt;!&ndash;        item.addEventListener('click', function() {&ndash;&gt;-->
<!--&lt;!&ndash;            navItems.forEach(nav => nav.classList.remove('active'));&ndash;&gt;-->
<!--&lt;!&ndash;            this.classList.add('active');&ndash;&gt;-->
<!--&lt;!&ndash;            // Placeholder: Add logic here to show/hide different content sections based on the tab&ndash;&gt;-->
<!--&lt;!&ndash;            console.log(`Mapsd to ${this.textContent} tab (Index: ${index})`);&ndash;&gt;-->
<!--&lt;!&ndash;            alert(`Mapsd to ${this.textContent} tab. (Content switching not implemented yet)`);&ndash;&gt;-->

<!--&lt;!&ndash;            // Example: Show/Hide Sections based on tab clicked&ndash;&gt;-->
<!--&lt;!&ndash;            const sections = document.querySelectorAll('.container > .section'); // Select direct children sections&ndash;&gt;-->
<!--&lt;!&ndash;            const navbar = document.querySelector('.navbar'); // Get navbar element&ndash;&gt;-->

<!--&lt;!&ndash;            // Hide all main sections initially&ndash;&gt;-->
<!--&lt;!&ndash;            sections.forEach(sec => sec.style.display = 'none');&ndash;&gt;-->
<!--&lt;!&ndash;            if (navbar) navbar.style.display = 'flex'; // Ensure navbar is always visible&ndash;&gt;-->

<!--&lt;!&ndash;            if (index === 0) { // Stocks Tab (Trending + Favorites)&ndash;&gt;-->
<!--&lt;!&ndash;                const trendingSection = document.getElementById('trendingSection');&ndash;&gt;-->
<!--&lt;!&ndash;                const favoriteSection = document.getElementById('favoriteSection');&ndash;&gt;-->
<!--&lt;!&ndash;                if (trendingSection) trendingSection.style.display = 'block';&ndash;&gt;-->
<!--&lt;!&ndash;                if (favoriteSection) favoriteSection.style.display = 'block';&ndash;&gt;-->
<!--&lt;!&ndash;            } else if (index === 1) { // Analytics Tab&ndash;&gt;-->
<!--&lt;!&ndash;                // Show an analytics section if you create one, e.g.:&ndash;&gt;-->
<!--&lt;!&ndash;                // const analyticsSection = document.getElementById('analyticsSection');&ndash;&gt;-->
<!--&lt;!&ndash;                // if(analyticsSection) analyticsSection.style.display = 'block';&ndash;&gt;-->
<!--&lt;!&ndash;                // For now, just log or keep the alert&ndash;&gt;-->
<!--&lt;!&ndash;                console.log("Display Analytics Content Here");&ndash;&gt;-->
<!--&lt;!&ndash;                alert("Displaying Analytics Content (Not Implemented)"); // Replace alert later&ndash;&gt;-->
<!--&lt;!&ndash;                // Or show a placeholder message section:&ndash;&gt;-->
<!--&lt;!&ndash;                const placeholderSectionId = 'analyticsPlaceholder';&ndash;&gt;-->
<!--&lt;!&ndash;                let placeholderSection = document.getElementById(placeholderSectionId);&ndash;&gt;-->
<!--&lt;!&ndash;                if (!placeholderSection) {&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection = document.createElement('div');&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.id = placeholderSectionId;&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.className = 'section'; // Use existing styling&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.innerHTML = `<h2>Analytics</h2><div class="message">Analytics dashboard coming soon.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;                    // Insert after the navbar or at a suitable location&ndash;&gt;-->
<!--&lt;!&ndash;                    const container = document.querySelector('.container');&ndash;&gt;-->
<!--&lt;!&ndash;                    if (container && navbar) container.insertBefore(placeholderSection, navbar.nextSibling);&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;                placeholderSection.style.display = 'block';&ndash;&gt;-->

<!--&lt;!&ndash;            } else if (index === 2) { // History Tab&ndash;&gt;-->
<!--&lt;!&ndash;                console.log("Display History Content Here");&ndash;&gt;-->
<!--&lt;!&ndash;                alert("Displaying History Content (Not Implemented)");&ndash;&gt;-->
<!--&lt;!&ndash;                // Show a placeholder message section:&ndash;&gt;-->
<!--&lt;!&ndash;                const placeholderSectionId = 'historyPlaceholder';&ndash;&gt;-->
<!--&lt;!&ndash;                let placeholderSection = document.getElementById(placeholderSectionId);&ndash;&gt;-->
<!--&lt;!&ndash;                if (!placeholderSection) {&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection = document.createElement('div');&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.id = placeholderSectionId;&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.className = 'section'; // Use existing styling&ndash;&gt;-->
<!--&lt;!&ndash;                    placeholderSection.innerHTML = `<h2>History</h2><div class="message">Trade history or activity log coming soon.</div>`;&ndash;&gt;-->
<!--&lt;!&ndash;                    const container = document.querySelector('.container');&ndash;&gt;-->
<!--&lt;!&ndash;                    if (container && navbar) container.insertBefore(placeholderSection, navbar.nextSibling);&ndash;&gt;-->
<!--&lt;!&ndash;                }&ndash;&gt;-->
<!--&lt;!&ndash;                placeholderSection.style.display = 'block';&ndash;&gt;-->
<!--&lt;!&ndash;            }&ndash;&gt;-->

<!--&lt;!&ndash;        });&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->

<!--&lt;!&ndash;    // -&#45;&#45; Initial Load -&#45;&#45;&ndash;&gt;-->
<!--&lt;!&ndash;    document.addEventListener('DOMContentLoaded', () => { // Ensure DOM is ready&ndash;&gt;-->
<!--&lt;!&ndash;        // Apply saved theme on initial load&ndash;&gt;-->
<!--&lt;!&ndash;        const savedTheme = localStorage.getItem('theme');&ndash;&gt;-->
<!--&lt;!&ndash;        const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;&ndash;&gt;-->

<!--&lt;!&ndash;        if (savedTheme === 'dark' || (!savedTheme && prefersDark)) { // Use saved or system preference&ndash;&gt;-->
<!--&lt;!&ndash;            body.classList.add('dark-mode');&ndash;&gt;-->
<!--&lt;!&ndash;            updateToggleButtonText(true);&ndash;&gt;-->
<!--&lt;!&ndash;        } else {&ndash;&gt;-->
<!--&lt;!&ndash;            updateToggleButtonText(false); // Set light mode text explicitly&ndash;&gt;-->
<!--&lt;!&ndash;        }&ndash;&gt;-->

<!--&lt;!&ndash;        loadTrending();&ndash;&gt;-->
<!--&lt;!&ndash;        loadFavorites();&ndash;&gt;-->

<!--&lt;!&ndash;        // Initialize view based on the default active tab (Stocks)&ndash;&gt;-->
<!--&lt;!&ndash;        navItems[0].click(); // Simulate click on the first tab to show correct sections&ndash;&gt;-->
<!--&lt;!&ndash;    });&ndash;&gt;-->


<!--&lt;!&ndash;</script>&ndash;&gt;-->
<!--&lt;!&ndash;</body>&ndash;&gt;-->
<!--&lt;!&ndash;</html>&ndash;&gt;-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trending Stocks - NSE (Alpha Vantage)</title>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Updated styling to match the debt management UI */
        body {
            font-family: 'Roboto', sans-serif;
            background: #f0f2f5;
            margin: 0;
            padding: 0;
            color: #333;
            padding-bottom: 90px; /* ADDED: Space for bottom navigation bar */
        }
        header {
            background: #2c3e50;
            color: #fff;
            padding: 20px;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0; /* Prevent header shrinking */
        }
        header h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 500;
        }
        .toggle-btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            flex-grow: 1; /* Allow container to grow */
            overflow-y: auto; /* Allow content scrolling if needed */
        }
        .section {
            background: #fff;
            padding: 20px;
            margin: 10px 0 20px 0;
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section h2 {
            margin-top: 0;
            font-weight: 500;
            color: #2c3e50;
            font-size: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        .stock-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .stock-item:hover {
            background: #f7f9fc;
        }
        .stock-info {
            display: flex;
            flex: 1;
            min-width: 0; /* Prevent overflow issues */
            align-items: center; /* Vertically align items */
        }
        .stock-info span {
            flex: 1;
            padding: 0 5px;
            white-space: nowrap; /* Prevent wrapping */
            overflow: hidden; /* Hide overflow */
            text-overflow: ellipsis; /* Add ellipsis */
        }
        /* Give symbol slightly more space */
        .stock-info span:first-child {
            flex: 1.2;
        }
        .delete-btn {
            background: #e74c3c;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            flex-shrink: 0; /* Prevent button from shrinking */
        }
        /* Form styling updated */
        form {
            display: flex;
            margin-bottom: 20px;
            flex-direction: column;
        }
        input[type="text"] {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            font-size: 16px;
        }
        button[type="submit"] {
            padding: 12px 20px;
            border: none;
            background: #2ecc71;
            color: #fff;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 10px;
        }
        /* Action buttons */
        .action-btn {
            display: block;
            width: 100%;
            padding: 12px 20px;
            margin: 10px 0;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
        }
        .primary-btn { background: #2ecc71; }
        .secondary-btn { background: #3498db; }

        /* Existing Navbar - POTENTIALLY REDUNDANT */
        .navbar {
            display: flex;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
        }
        .nav-item {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            background: #f0f2f5;
            color: #333; /* Added text color */
            transition: background-color 0.2s, color 0.2s; /* Added transition */
        }
        .nav-item.active {
            background: #3498db;
            color: white;
        }
        /* End Existing Navbar */

        /* Overlay styling */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: hidden;
            opacity: 0;
            transition: opacity 0.3s, visibility 0.3s;
            z-index: 1000; /* Above everything except maybe float button if needed */
        }
        .overlay.active {
            visibility: visible;
            opacity: 1;
        }
        .overlay-content {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #95a5a6;
            color: #fff;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
        }
        canvas {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
        }
        .positive { color: #2ecc71; font-weight: 500; }
        .negative { color: #e74c3c; font-weight: 500; }
        .message { text-align: center; color: #7f8c8d; padding: 20px; }
        .action-buttons { display: flex; margin-top: 20px; gap: 10px; }
        .action-buttons button { flex: 1; }

        /* Float button */
        .float-btn {
            position: fixed;
            bottom: 80px; /* ADJUSTED: Position above nav bar */
            right: 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 1001; /* ADJUSTED: Above overlay and nav bar */
        }
        .float-btn span { margin-left: 8px; }

        /* --- ADDED: Bottom Navigation Bar Styles --- */
        .nav-bar {
            position: fixed; /* Fixed position at the bottom */
            bottom: 0;
            left: 0;
            right: 0;
            background: #fff; /* White background */
            display: flex;
            justify-content: space-around;
            padding: 1rem 0;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.08); /* Shadow above the bar */
            z-index: 999; /* Below overlay (1000) and float btn (1001) */
        }
        .nav-button {
            text-decoration: none; /* Remove underline from links */
            padding: 0.6rem 1rem; /* Adjust padding */
            border-radius: 8px; /* Match existing style */
            cursor: pointer;
            color: #7f8c8d; /* Default text color */
            transition: all 0.2s;
            font-size: 13px; /* Adjust font size */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1; /* Allow buttons to take up space */
            text-align: center; /* Center text */
            min-width: 0; /* Prevent overflow on small screens */
        }
        .nav-button.active {
            background: #3498db; /* Active button background */
            color: white; /* Active button text color */
            box-shadow: 0 4px 12px rgba(52,152,219,0.2); /* Optional shadow */
        }
        /* --- End Bottom Navigation Bar Styles --- */

        /* Responsive adjustments */
        @media (max-width: 600px) {
            header { padding: 15px; }
            header h1 { font-size: 20px; }
            .container { padding: 15px; }
            .stock-info span { font-size: 14px; }
            .delete-btn { padding: 4px 8px; font-size: 12px; }
            .float-btn { bottom: 75px; padding: 10px 15px; font-size: 14px; } /* Adjust float btn */
            .nav-button { padding: 0.5rem 0.5rem; font-size: 11px; } /* Adjust bottom nav */
            body { padding-bottom: 80px; } /* Ensure padding for smaller nav */
        }

    </style>
</head>
<body>
<header>
    <h1>Stock Tracker</h1>
    <button class="toggle-btn">Toggle Theme</button>
</header>

<div class="container">
    <div class="section" id="trendingSection">
        <h2>Trending Stocks</h2>
        <div id="trendingList"><div class="message">Loading trending stocks...</div></div>
    </div>
    <div class="section" id="favoriteSection">
        <h2>Favorite Stocks</h2>
        <form id="favoriteForm">
            <input type="text" id="favoriteInput" placeholder="Enter NSE symbol (e.g. TCS.NS)" required>
            <button type="submit" class="primary-btn">Add Stock</button>
        </form>
        <div id="favoriteList"><div class="message">No favorite stocks added yet.</div></div>
        <button class="action-btn secondary-btn" id="showAnalysisBtn">Show Analytics</button>
    </div>

    <div class="navbar">
        <div class="nav-item active">Stocks</div>
        <div class="nav-item">Analytics</div>
        <div class="nav-item">History</div>
    </div>
</div> <button class="float-btn">
    +
    <span>Add Stock</span>
</button>
<div class="overlay" id="overlay">
    <div class="overlay-content">
        <button class="close-btn" id="closeOverlay">Close</button>
        <div id="stockDetails"><div class="message">Loading details...</div></div>
        <canvas id="stockChart"></canvas>
        <div class="action-buttons">
            <button class="action-btn primary-btn" id="analyzeBtn">Analyze Strategy</button>
        </div>
    </div>
</div>
<div class="nav-bar">
    <a href="DashboardPage.html" class="nav-button">Dashboard</a>
    <a href="DebtClearance.html" class="nav-button">Debt</a>
    <a href="#" class="nav-button active">Stock</a>
    <a href="UserPage.html" class="nav-button">User Profile</a>
</div>
<script>
    // --- Configuration ---
    const apiKey = 'FUI5OGIATFMMMIHV'; // Your provided Alpha Vantage API key
    // Note: Alpha Vantage free tier limitations apply.
    let trendingSymbols = ["TCS.NS", "RELIANCE.NS", "INFY.NS", "HDFCBANK.NS", "ICICIBANK.NS"];
    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];
    let chartInstance = null;

    // --- DOM Elements ---
    const trendingListContainer = document.getElementById("trendingList");
    const favoriteListContainer = document.getElementById("favoriteList");
    const favoriteForm = document.getElementById("favoriteForm");
    const favoriteInput = document.getElementById("favoriteInput");
    const overlay = document.getElementById("overlay");
    const closeOverlayBtn = document.getElementById("closeOverlay");
    const stockDetailsContainer = document.getElementById("stockDetails");
    const stockChartCanvas = document.getElementById("stockChart").getContext('2d'); // Get context directly
    const toggleThemeBtn = document.querySelector(".toggle-btn");
    const showAnalysisBtn = document.getElementById("showAnalysisBtn");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const floatBtn = document.querySelector(".float-btn");
    const navItems = document.querySelectorAll(".nav-item"); // Existing top nav items

    // --- API Functions ---
    async function fetchStockData(symbols, callback) {
        if (apiKey === 'YOUR_API_KEY' || !apiKey) { // Added check for empty key
            console.error("API Key not set. Please replace 'YOUR_API_KEY'.");
            callback(null, "API Key not configured.");
            return;
        }
        if (!symbols || symbols.length === 0) {
            callback([]); // Return empty array if no symbols
            return;
        }

        const promises = symbols.map(async (symbol) => { // Added async here
            const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${apiKey}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status} for ${symbol}`);
                const data = await response.json();

                // Check for API call frequency limit note
                if (data.Note) {
                    console.warn(`API Note for ${symbol}: ${data.Note}`);
                    // You might want to handle this, e.g., by delaying the next request
                    await new Promise(resolve => setTimeout(resolve, 15000)); // Wait 15s if hitting limit
                    // Retry fetch after delay
                    const retryResponse = await fetch(url);
                    if (!retryResponse.ok) throw new Error(`HTTP error! status: ${retryResponse.status} for ${symbol} (after retry)`);
                    const retryData = await retryResponse.json();
                    if (retryData.Note) { // Still hitting limit after retry
                        throw new Error(`API rate limit hit for ${symbol} even after delay.`);
                    }
                    if (retryData['Error Message'] || !retryData['Global Quote'] || Object.keys(retryData['Global Quote']).length === 0) {
                        console.warn(`No data or error for symbol ${symbol} (after retry):`, retryData['Error Message'] || 'Empty quote');
                        return null;
                    }
                    const quote = retryData['Global Quote'];
                    return mapQuoteData(quote); // Use helper function
                }

                if (data['Error Message'] || !data['Global Quote'] || Object.keys(data['Global Quote']).length === 0) {
                    console.warn(`No data or error for symbol ${symbol}:`, data['Error Message'] || 'Empty quote');
                    return null;
                }
                const quote = data['Global Quote'];
                return mapQuoteData(quote); // Use helper function

            } catch (error) {
                console.error(`Failed to fetch data for ${symbol}:`, error);
                return null;
            }
        });

        try {
            const results = await Promise.all(promises);
            const validResults = results.filter(result => result !== null);
            if (validResults.length === 0 && symbols.length > 0) {
                callback(null, "Failed to fetch data. Check API key, symbol format (e.g., TCS.NS), or rate limits.");
            } else {
                callback(validResults);
            }
        } catch (error) {
            console.error("Error processing stock data fetches:", error);
            callback(null, "An error occurred while fetching data.");
        }
    }

    // Helper function to map Alpha Vantage quote data
    function mapQuoteData(quote) {
        return {
            symbol: quote['01. symbol'],
            longName: quote['01. symbol'], // Placeholder
            regularMarketPrice: parseFloat(quote['05. price']),
            regularMarketChange: parseFloat(quote['09. change']),
            regularMarketChangePercent: parseFloat(quote['10. change percent']?.replace('%', '') || '0'), // Safer parsing
            currency: 'INR' // Assumption
        };
    }

    function fetchHistoricalData(symbol, callback) {
        if (apiKey === 'YOUR_API_KEY' || !apiKey) {
            console.error("API Key not set.");
            callback(null, "API Key not configured.");
            return;
        }
        // Use compact for fewer data points (suitable for free tier)
        const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=compact&apikey=${apiKey}`;

        fetch(url)
            .then(res => {
                if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
                return res.json();
            })
            .then(data => {
                if (data.Note) { // Handle API limit note
                    console.warn(`API Note for ${symbol} (Historical): ${data.Note}`);
                    throw new Error("API rate limit likely hit fetching historical data.");
                }
                if (data['Error Message'] || !data['Time Series (Daily)']) {
                    throw new Error(data['Error Message'] || `Invalid historical data format for ${symbol}.`);
                }
                const timeSeries = data['Time Series (Daily)'];
                const timestamps = Object.keys(timeSeries).sort().slice(-30); // Get last ~30 days
                if (timestamps.length === 0) {
                    throw new Error(`No valid timestamps found in historical data for ${symbol}.`);
                }

                const prices = timestamps.map(date => parseFloat(timeSeries[date]['4. close']));
                const labels = timestamps.map(date => {
                    const [year, month, day] = date.split('-');
                    return `${day}/${month}`; // Format DD/MM
                });

                callback({ labels, prices });
            })
            .catch(error => {
                console.error(`Failed to fetch historical data for ${symbol}:`, error);
                callback(null, error.message || "Failed to fetch historical data.");
            });
    }

    // --- Rendering Functions ---
    function renderStocks(list, container, isFavorite = false, errorMessage = null) {
        container.innerHTML = ""; // Clear previous content

        if (errorMessage) {
            container.innerHTML = `<div class="message">${errorMessage}</div>`;
            return;
        }

        if (!list || list.length === 0) {
            const message = isFavorite ? "No favorite stocks added." : "No trending stocks available.";
            container.innerHTML = `<div class="message">${message}</div>`;
            return;
        }

        list.forEach(stock => {
            if (!stock || !stock.symbol) {
                console.warn("Skipping invalid stock data:", stock);
                return;
            }

            const div = document.createElement("div");
            div.className = "stock-item";
            div.setAttribute('data-symbol', stock.symbol);

            const changePercentVal = stock.regularMarketChangePercent;
            const priceVal = stock.regularMarketPrice;

            const changePercent = (typeof changePercentVal === 'number') ? changePercentVal.toFixed(2) + "%" : "N/A";
            const changeClass = (typeof changePercentVal === 'number') ? (changePercentVal > 0 ? "positive" : (changePercentVal < 0 ? "negative" : "")) : "";
            const price = (typeof priceVal === 'number') ? priceVal.toFixed(2) : "N/A";
            const currency = stock.currency || "";

            const stockInfo = document.createElement("div");
            stockInfo.className = "stock-info";
            // Ensure spans are created correctly
            stockInfo.innerHTML = `
                <span title="${stock.symbol}">${stock.symbol}</span>
                <span title="Price: ${price} ${currency}">${price} ${currency}</span>
                <span class="${changeClass}" title="Change: ${changePercent}">${changePercent}</span>
            `;

            div.appendChild(stockInfo);

            div.addEventListener("click", () => showOverlay(stock.symbol));

            if (isFavorite) {
                const delBtn = document.createElement("button");
                delBtn.className = "delete-btn";
                delBtn.innerText = "Delete";
                delBtn.addEventListener("click", (e) => {
                    e.stopPropagation();
                    removeFavorite(stock.symbol);
                });
                div.appendChild(delBtn);
            }

            container.appendChild(div);
        });
    }

    function showOverlay(symbol) {
        stockDetailsContainer.innerHTML = `<div class="message">Loading details for ${symbol}...</div>`;
        if (chartInstance) {
            chartInstance.destroy();
            chartInstance = null;
        }
        overlay.classList.add("active");

        fetchStockData([symbol], (data, error) => { // Fetch fresh data for the overlay
            if (error || !data || data.length === 0) {
                stockDetailsContainer.innerHTML = `<div class="message">Failed to load details for ${symbol}. ${error || 'No data found.'}</div>`;
                return;
            }

            const info = data[0];
            const changePercentVal = info.regularMarketChangePercent;
            const priceVal = info.regularMarketPrice;
            const changeVal = info.regularMarketChange;

            const changePercent = (typeof changePercentVal === 'number') ? changePercentVal.toFixed(2) + "%" : "N/A";
            const changeClass = (typeof changePercentVal === 'number') ? (changePercentVal > 0 ? "positive" : (changePercentVal < 0 ? "negative" : "")) : "";
            const price = (typeof priceVal === 'number') ? priceVal.toFixed(2) : "N/A";
            const change = (typeof changeVal === 'number') ? changeVal.toFixed(2) : "N/A";
            const currency = info.currency || "";
            const name = info.longName || info.symbol;

            const detailsHTML = `
                <h2>${name} (${info.symbol})</h2>
                <p><strong>Price:</strong> ${price} ${currency}</p>
                <p><strong>Change:</strong> ${change} (<span class="${changeClass}">${changePercent}</span>)</p>
                <hr>
                <p><em id="chart-loading-msg">Loading chart data...</em></p>
            `;
            stockDetailsContainer.innerHTML = detailsHTML;

            fetchHistoricalData(symbol, (histData, histError) => {
                const chartLoadingMsg = document.getElementById('chart-loading-msg');
                if (histError || !histData || !histData.labels || !histData.prices || histData.labels.length === 0) {
                    if(chartLoadingMsg) chartLoadingMsg.textContent = `Chart data unavailable. ${histError || 'No data points.'}`;
                    console.error("Failed to get historical data for chart:", histError || histData);
                    return;
                }

                if(chartLoadingMsg) chartLoadingMsg.style.display = 'none'; // Hide loading message

                if (chartInstance) { chartInstance.destroy(); } // Destroy previous before creating new

                try { // Add try-catch for chart creation
                    chartInstance = new Chart(stockChartCanvas, { // Use the context obtained earlier
                        type: "line",
                        data: {
                            labels: histData.labels,
                            datasets: [{
                                label: `${symbol} Closing Price`,
                                data: histData.prices,
                                borderColor: "#3498db",
                                backgroundColor: "rgba(52, 152, 219, 0.1)",
                                fill: true,
                                tension: 0.1,
                                pointRadius: 2, // Smaller points
                                pointHoverRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true, // Maintain aspect ratio can be better
                            plugins: {
                                title: { display: true, text: `Recent Performance` },
                                legend: { display: false } // Hide legend if only one dataset
                            },
                            scales: { y: { beginAtZero: false } }
                        }
                    });
                } catch (chartError) {
                    console.error("Error creating chart:", chartError);
                    if(chartLoadingMsg) {
                        chartLoadingMsg.textContent = 'Failed to render chart.';
                        chartLoadingMsg.style.display = 'block';
                    }
                }
            });
        });
    }

    // --- Favorite Management ---
    function addFavorite(symbol) {
        // Basic validation for NSE symbols (e.g., ends with .NS)
        const upperSymbol = symbol.trim().toUpperCase();
        if (!upperSymbol) return; // Ignore empty input

        if (!upperSymbol.endsWith(".NS")) {
            alert("Please enter a valid NSE symbol ending with '.NS' (e.g., TCS.NS)");
            favoriteInput.focus(); // Keep focus on input
            return;
        }

        if (!favorites.includes(upperSymbol)) {
            favorites.push(upperSymbol);
            localStorage.setItem("favorites", JSON.stringify(favorites));
            loadFavorites(); // Refresh the list
        } else {
            alert(`${upperSymbol} is already in favorites.`);
        }
        favoriteInput.value = "";
    }

    function removeFavorite(symbol) {
        favorites = favorites.filter(fav => fav !== symbol);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        loadFavorites();
    }

    // --- Initial Load Functions ---
    function loadTrending() {
        trendingListContainer.innerHTML = `<div class="message">Loading trending stocks...</div>`;
        // Use a smaller set for trending to reduce API calls if needed
        fetchStockData(trendingSymbols.slice(0, 5), (data, error) => {
            renderStocks(data, trendingListContainer, false, error);
        });
    }

    function loadFavorites() {
        if (favorites.length === 0) {
            renderStocks([], favoriteListContainer, true); // Render empty state explicitly
            return;
        }
        favoriteListContainer.innerHTML = `<div class="message">Loading favorite stocks...</div>`;
        fetchStockData(favorites, (data, error) => {
            renderStocks(data, favoriteListContainer, true, error);
        });
    }

    // --- Event Listeners ---
    favoriteForm.addEventListener("submit", (e) => {
        e.preventDefault();
        addFavorite(favoriteInput.value);
    });

    closeOverlayBtn.addEventListener("click", () => {
        overlay.classList.remove("active");
        if (chartInstance) { chartInstance.destroy(); chartInstance = null; }
    });

    overlay.addEventListener('click', (e) => {
        if (e.target === overlay) { closeOverlayBtn.click(); }
    });

    toggleThemeBtn.addEventListener('click', () => {
        alert('Theme toggle functionality placeholder.');
        // Basic theme toggle example (add dark-mode class to body)
        // document.body.classList.toggle('dark-mode');
        // You would need corresponding .dark-mode CSS rules
    });

    showAnalysisBtn.addEventListener('click', () => {
        alert('Stock analytics placeholder.');
    });

    analyzeBtn.addEventListener('click', () => {
        alert('Stock strategy analysis placeholder.');
    });

    floatBtn.addEventListener('click', () => {
        // Scroll to the add favorite form and focus the input
        favoriteForm.scrollIntoView({ behavior: 'smooth', block: 'center' });
        favoriteInput.focus();
    });

    // Existing Navbar click handlers (potentially redundant)
    navItems.forEach(item => {
        item.addEventListener('click', function() {
            navItems.forEach(nav => nav.classList.remove('active'));
            this.classList.add('active');
            alert(`(Old Nav) Would navigate to ${this.textContent} tab`);
        });
    });

    // --- Initial Load ---
    document.addEventListener('DOMContentLoaded', () => { // Ensure DOM is ready
        loadTrending();
        loadFavorites();
    });
</script>
</body>
</html>